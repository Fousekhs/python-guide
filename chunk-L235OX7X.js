import{b as P,c as l,d as y,e as S,g as A,j as E,k as R,o as k,q as F}from"./chunk-TMDLGDPT.js";import{w as x}from"./chunk-ZCTLOLTJ.js";import{b as _,d as M}from"./chunk-FD3KUP4A.js";import{$a as c,Ab as C,Bb as g,Ea as s,Ja as m,Na as w,_a as u,db as f,eb as o,fb as i,gb as p,nb as h,pb as b,zb as a}from"./chunk-PT7SL42D.js";import"./chunk-WTI2L5DI.js";function N(n,t){n&1&&(o(0,"div",3)(1,"label",12),a(2,"Username"),i(),p(3,"input",13),i())}function I(n,t){n&1&&(o(0,"div",9),a(1," Passwords do not match "),i())}function T(n,t){if(n&1&&(o(0,"div",3)(1,"label",14),a(2,"Confirm Password"),i(),p(3,"input",15),u(4,I,2,0,"div",9),i()),n&2){let r=b();s(4),c(r.showPasswordMismatch?4:-1)}}function q(n,t){if(n&1&&(o(0,"div",9),a(1),i()),n&2){let r=b();s(),g(" ",r.errorMessage," ")}}var O=class n{constructor(t,r,e,d){this.fb=t;this.router=r;this.route=e;this.authService=d}authForm;isRegisterMode=!1;errorMessage=null;ngOnInit(){this.isRegisterMode=!!this.route.snapshot.data.register,this.buildForm()}buildForm(){this.isRegisterMode?this.authForm=this.fb.group({email:["",[l.required,l.email]],displayName:["",l.required],password:["",l.required],confirmPassword:["",l.required]},{validators:this.passwordMatchValidator}):this.authForm=this.fb.group({email:["",[l.required,l.email]],password:["",l.required]})}toggleMode(){this.router.navigate([this.isRegisterMode?"/login":"/register"])}goBack(){this.router.navigate(["/"])}onSubmit(){if(this.authForm.invalid)return;let{email:t,displayName:r,password:e,confirmPassword:d}=this.authForm.value;if(this.isRegisterMode){if(e!==d){this.authForm.setErrors({passwordMismatch:!0});return}this.authService.register(t,e,r).subscribe({next:()=>{alert("Registration successful! You can now log in."),this.router.navigate(["/login"])},error:v=>{this.errorMessage=this.mapAuthError(v,!0)}})}else this.authService.login(t,e).subscribe({next:()=>{this.router.navigate(["/"])},error:v=>{this.errorMessage=this.mapAuthError(v,!1)}})}passwordMatchValidator(t){let r=t.get("password")?.value,e=t.get("confirmPassword")?.value;return r!==e?{passwordMismatch:!0}:null}get showPasswordMismatch(){return this.authForm.hasError("passwordMismatch")&&this.authForm.get("confirmPassword")?.touched&&this.isRegisterMode||!1}mapAuthError(t,r){if(!t?.code)return"An unknown error occurred.";let e=t.code;if(r)switch(e){case"auth/email-already-in-use":return"That email address is already taken.";case"auth/invalid-email":return"The email address is badly formatted.";case"auth/weak-password":return"Password is too weak (should be at least 6 characters).";default:return"Registration failed. "+t.message}else switch(e){case"auth/user-not-found":return"No account with that email exists.";case"auth/wrong-password":return"Incorrect password.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later.";default:return"Login failed. "+t.message}}static \u0275fac=function(r){return new(r||n)(m(k),m(M),m(_),m(x))};static \u0275cmp=w({type:n,selectors:[["app-auth"]],decls:25,vars:8,consts:[[1,"auth-wrapper"],[1,"auth-container"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],["id","email","type","email","formControlName","email"],["for","password"],["id","password","type","password","formControlName","password"],["type","submit",3,"disabled"],[1,"error"],[1,"nav-btns"],[1,"nav-btn",3,"click"],["for","username"],["id","username","type","text","formControlName","displayName"],["for","confirmPassword"],["id","confirmPassword","type","password","formControlName","confirmPassword"]],template:function(r,e){r&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),a(3),i(),o(4,"form",2),h("ngSubmit",function(){return e.onSubmit()}),o(5,"div",3)(6,"label",4),a(7,"Email"),i(),p(8,"input",5),i(),u(9,N,4,0,"div",3),o(10,"div",3)(11,"label",6),a(12,"Password"),i(),p(13,"input",7),i(),u(14,T,5,1,"div",3),o(15,"button",8),a(16),i(),u(17,q,2,1,"div",9),i(),o(18,"div",10)(19,"button",11),h("click",function(){return e.toggleMode()}),a(20),i(),o(21,"div"),a(22," or "),i(),o(23,"button",11),h("click",function(){return e.goBack()}),a(24,"Go to Home"),i()()()()),r&2&&(s(3),C(e.isRegisterMode?"Register":"Login"),s(),f("formGroup",e.authForm),s(5),c(e.isRegisterMode?9:-1),s(5),c(e.isRegisterMode?14:-1),s(),f("disabled",e.authForm.invalid),s(),g(" ",e.isRegisterMode?"Register":"Login"," "),s(),c(e.errorMessage!==null?17:-1),s(3),g(" ",e.isRegisterMode?"Already have an account?":"Create an account"," "))},dependencies:[F,A,P,y,S,E,R],styles:[".auth-wrapper[_ngcontent-%COMP%]{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.auth-container[_ngcontent-%COMP%]{width:400px;padding:2rem;background-color:var(--dark-blue);border-radius:8px;box-shadow:0 4px 10px #0000001a;transition:min-height .2s}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}input[_ngcontent-%COMP%]{all:unset;border-bottom:var(--white) 2px solid;height:2.5rem;width:100%;padding:.5rem;font-size:1rem;box-sizing:border-box}input[_ngcontent-%COMP%]:focus{border-color:var(--electric-blue);transition:border-color .5s}button[_ngcontent-%COMP%]{width:100%;padding:.75rem;font-weight:700;margin-top:1rem;cursor:pointer;background-color:var(--white);color:var(--darkest-blue)}button[_ngcontent-%COMP%]:hover{background-color:var(--electric-blue);color:var(--darkest-blue)}button[_ngcontent-%COMP%]:disabled{background-color:var(--disabled-grey);color:var(--dark-blue);cursor:not-allowed}.error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--failed-red);font-size:.9rem;margin-top:.25rem}.nav-btn[_ngcontent-%COMP%]{padding:0;margin:0;background:none;color:var(--white);border:none;cursor:pointer;text-decoration:underline}.nav-btn[_ngcontent-%COMP%]:hover{background-color:transparent;color:var(--electric-blue)}.nav-btns[_ngcontent-%COMP%]{display:flex;gap:.25rem;margin-top:1rem}"]})};export{O as AuthComponent};
