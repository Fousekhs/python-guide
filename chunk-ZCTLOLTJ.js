import{$ as xn,Ba as Ea,Rb as wa,S as Mn,T as ma,Ua as oe,Wb as sr,X as ga,Y as va,Z as ya,c as se,ca as ft,da as ir,ea as Q,fa as pt,ha as Ia,i as da,ia as Fn,j as ha,l as er,m as tr,ma as Te,n as nr,o as ht,oa as rr,p as fa,q as pa,ta as Un,u as _a,ua as z}from"./chunk-PT7SL42D.js";import{a as Xi,b as Zi,f as Ve,g as f}from"./chunk-WTI2L5DI.js";var Ta=()=>{};var ar={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var _=function(n,e){if(!n)throw Be(e)},Be=function(n){return new Error("Firebase Database ("+ar.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var Sa=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},hd=function(n){let e=[],t=0,i=0;for(;t<n.length;){let r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){let s=n[t++],o=n[t++],a=n[t++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{let s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},gt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,l=c?n[r+2]:0,u=s>>2,h=(s&3)<<4|a>>4,d=(a&15)<<2|l>>6,p=l&63;c||(p=64,o||(d=64)),i.push(t[u],t[h],t[d],t[p])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Sa(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):hd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;let l=r<n.length?t[n.charAt(r)]:64;++r;let h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||l==null||h==null)throw new cr;let d=s<<2|a>>4;if(i.push(d),l!==64){let p=a<<4&240|l>>2;if(i.push(p),h!==64){let m=l<<6&192|h;i.push(m)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},cr=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},ur=function(n){let e=Sa(n);return gt.encodeByteArray(e,!0)},Bt=function(n){return ur(n).replace(/\./g,"")},_t=function(n){try{return gt.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Aa(n){return ka(void 0,n)}function ka(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!fd(t)||(n[t]=ka(n[t],e[t]));return n}function fd(n){return n!=="__proto__"}function Ra(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var pd=()=>Ra().__FIREBASE_DEFAULTS__,_d=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},md=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&_t(n[1]);return e&&JSON.parse(e)},dr=()=>{try{return Ta()||pd()||_d()||md()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},hr=n=>{var e,t;return(t=(e=dr())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Pa=n=>{let e=hr(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},fr=()=>{var n;return(n=dr())===null||n===void 0?void 0:n.config},pr=n=>{var e;return(e=dr())===null||e===void 0?void 0:e[`_${n}`]};var q=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}};function Ce(n){return n.endsWith(".cloudworkstations.dev")}function Vn(n){return f(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Na(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Bt(JSON.stringify(t)),Bt(JSON.stringify(o)),""].join(".")}var Vt={};function gd(){let n={prod:[],emulator:[]};for(let e of Object.keys(Vt))Vt[e]?n.emulator.push(e):n.prod.push(e);return n}function vd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Ca=!1;function Bn(n,e){if(typeof window>"u"||typeof document>"u"||!Ce(window.location.host)||Vt[n]===e||Vt[n]||Ca)return;Vt[n]=e;function t(d){return`__firebase__banner__${d}`}let i="__firebase__banner",s=gd().prod.length>0;function o(){let d=document.getElementById(i);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function c(d,p){d.setAttribute("width","24"),d.setAttribute("id",p),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function l(){let d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{Ca=!0,o()},d}function u(d,p){d.setAttribute("id",p),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){let d=vd(i),p=t("text"),m=document.getElementById(p)||document.createElement("span"),w=t("learnmore"),A=document.getElementById(w)||document.createElement("a"),H=t("preprendIcon"),j=document.getElementById(H)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){let J=d.element;a(J),u(A,w);let dt=l();c(j,H),J.append(j,m,A,dt),document.body.appendChild(J)}s?(m.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,m.innerText="Preview backend running in this workspace."),m.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function F(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $t(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(F())}function Oa(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Da(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function $n(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function La(){let n=F();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ae(){return ar.NODE_CLIENT===!0||ar.NODE_ADMIN===!0}function Hn(){try{return typeof indexedDB=="object"}catch{return!1}}function Ma(){return new Promise((n,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var yd="FirebaseError",X=class n extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=yd,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Z.prototype.create)}},Z=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?Id(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new X(r,a,i)}};function Id(n,e){return n.replace(Ed,(t,i)=>{let r=e[i];return r!=null?String(r):`<${i}?>`})}var Ed=/\{\$([^}]+)}/g;function mt(n){return JSON.parse(n)}function N(n){return JSON.stringify(n)}var xa=function(n){let e={},t={},i={},r="";try{let s=n.split(".");e=mt(_t(s[0])||""),t=mt(_t(s[1])||""),r=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:r}};var Fa=function(n){let e=xa(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Ua=function(n){let e=xa(n).claims;return typeof e=="object"&&e.admin===!0};function ee(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function $e(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Ht(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function jt(n,e,t){let i={};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=e.call(t,n[r],r,n));return i}function ce(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);for(let r of t){if(!i.includes(r))return!1;let s=n[r],o=e[r];if(ba(s)&&ba(o)){if(!ce(s,o))return!1}else if(s!==o)return!1}for(let r of i)if(!t.includes(r))return!1;return!0}function ba(n){return n!==null&&typeof n=="object"}function He(n){let e=[];for(let[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function vt(n){let e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){let[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function yt(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}var Wn=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);let i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){let d=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(d<<1|d>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,u;for(let h=0;h<80;h++){h<40?h<20?(l=a^s&(o^a),u=1518500249):(l=s^o^a,u=1859775393):h<60?(l=s&o|a&(s|o),u=2400959708):(l=s^o^a,u=3395469782);let d=(r<<5|r>>>27)+l+c+u+i[h]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=d}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);let i=t-this.blockSize,r=0,s=this.buf_,o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<t;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){let e=[],t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}};function Wa(n,e){let t=new lr(n,e);return t.subscribe.bind(t)}var lr=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");wd(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=or),r.error===void 0&&(r.error=or),r.complete===void 0&&(r.complete=or);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function wd(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function or(){}function It(n,e){return`${n} failed: ${e} argument `}var Va=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){let s=r-55296;i++,_(i<n.length,"Surrogate pair missing trail surrogate.");let o=n.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},zt=function(n){let e=0;for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};var Uv=14400*1e3;function O(n){return n&&n._delegate?n._delegate:n}var U=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var je="[DEFAULT]";var jn=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let i=new q;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(e?.identifier),r=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Cd(e))try{this.getOrInitializeService({instanceIdentifier:je})}catch{}for(let[t,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=je){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return f(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=je){return this.instances.has(e)}getOptions(e=je){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;let r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Td(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=je){return this.component?this.component.multipleInstances?e:je:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Td(n){return n===je?void 0:n}function Cd(n){return n.instantiationMode==="EAGER"}var qt=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new jn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var bd=[],b=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(b||{}),Sd={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},Ad=b.INFO,kd={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},Rd=(n,e,...t)=>{if(e<n.logLevel)return;let i=new Date().toISOString(),r=kd[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},le=class{constructor(e){this.name=e,this._logLevel=Ad,this._logHandler=Rd,this._userLogHandler=null,bd.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in b))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Sd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...e),this._logHandler(this,b.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...e),this._logHandler(this,b.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,b.INFO,...e),this._logHandler(this,b.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,b.WARN,...e),this._logHandler(this,b.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...e),this._logHandler(this,b.ERROR,...e)}};var Pd=(n,e)=>e.some(t=>n instanceof t),Ba,$a;function Nd(){return Ba||(Ba=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Od(){return $a||($a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Ha=new WeakMap,mr=new WeakMap,ja=new WeakMap,_r=new WeakMap,vr=new WeakMap;function Dd(n){let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(ue(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Ha.set(t,n)}).catch(()=>{}),vr.set(e,n),e}function Ld(n){if(mr.has(n))return;let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});mr.set(n,e)}var gr={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return mr.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ja.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ue(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function za(n){gr=n(gr)}function Md(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=n.call(zn(this),e,...t);return ja.set(i,e.sort?e.sort():[e]),ue(i)}:Od().includes(n)?function(...e){return n.apply(zn(this),e),ue(Ha.get(this))}:function(...e){return ue(n.apply(zn(this),e))}}function xd(n){return typeof n=="function"?Md(n):(n instanceof IDBTransaction&&Ld(n),Pd(n,Nd())?new Proxy(n,gr):n)}function ue(n){if(n instanceof IDBRequest)return Dd(n);if(_r.has(n))return _r.get(n);let e=xd(n);return e!==n&&(_r.set(n,e),vr.set(e,n)),e}var zn=n=>vr.get(n);function Ga(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(n,e),a=ue(o);return i&&o.addEventListener("upgradeneeded",c=>{i(ue(o.result),c.oldVersion,c.newVersion,ue(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",l=>r(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var Fd=["get","getKey","getAll","getAllKeys","count"],Ud=["put","add","delete","clear"],yr=new Map;function qa(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(yr.get(e))return yr.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,r=Ud.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||Fd.includes(t)))return;let s=function(o,...a){return f(this,null,function*(){let c=this.transaction(o,r?"readwrite":"readonly"),l=c.store;return i&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),r&&c.done]))[0]})};return yr.set(e,s),s}za(n=>Zi(Xi({},n),{get:(e,t,i)=>qa(e,t)||n.get(e,t,i),has:(e,t)=>!!qa(e,t)||n.has(e,t)}));var Er=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Wd(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function Wd(n){let e=n.getComponent();return e?.type==="VERSION"}var wr="@firebase/app",Ka="0.13.1";var me=new le("@firebase/app"),Vd="@firebase/app-compat",Bd="@firebase/analytics-compat",$d="@firebase/analytics",Hd="@firebase/app-check-compat",jd="@firebase/app-check",zd="@firebase/auth",qd="@firebase/auth-compat",Gd="@firebase/database",Kd="@firebase/data-connect",Yd="@firebase/database-compat",Jd="@firebase/functions",Qd="@firebase/functions-compat",Xd="@firebase/installations",Zd="@firebase/installations-compat",eh="@firebase/messaging",th="@firebase/messaging-compat",nh="@firebase/performance",ih="@firebase/performance-compat",rh="@firebase/remote-config",sh="@firebase/remote-config-compat",oh="@firebase/storage",ah="@firebase/storage-compat",ch="@firebase/firestore",lh="@firebase/ai",uh="@firebase/firestore-compat",dh="firebase",hh="11.9.0";var Tr="[DEFAULT]",fh={[wr]:"fire-core",[Vd]:"fire-core-compat",[$d]:"fire-analytics",[Bd]:"fire-analytics-compat",[jd]:"fire-app-check",[Hd]:"fire-app-check-compat",[zd]:"fire-auth",[qd]:"fire-auth-compat",[Gd]:"fire-rtdb",[Kd]:"fire-data-connect",[Yd]:"fire-rtdb-compat",[Jd]:"fire-fn",[Qd]:"fire-fn-compat",[Xd]:"fire-iid",[Zd]:"fire-iid-compat",[eh]:"fire-fcm",[th]:"fire-fcm-compat",[nh]:"fire-perf",[ih]:"fire-perf-compat",[rh]:"fire-rc",[sh]:"fire-rc-compat",[oh]:"fire-gcs",[ah]:"fire-gcs-compat",[ch]:"fire-fst",[uh]:"fire-fst-compat",[lh]:"fire-vertex","fire-js":"fire-js",[dh]:"fire-js-all"};var Gt=new Map,ph=new Map,Cr=new Map;function Ya(n,e){try{n.container.addComponent(e)}catch(t){me.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function te(n){let e=n.name;if(Cr.has(e))return me.debug(`There were multiple attempts to register component ${e}.`),!1;Cr.set(e,n);for(let t of Gt.values())Ya(t,n);for(let t of ph.values())Ya(t,n);return!0}function Et(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function $(n){return n==null?!1:n.settings!==void 0}var _h={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},be=new Z("app","Firebase",_h);var br=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new U("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw be.create("app-deleted",{appName:this._name})}};var Se=hh;function kr(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let i=Object.assign({name:Tr,automaticDataCollectionEnabled:!0},e),r=i.name;if(typeof r!="string"||!r)throw be.create("bad-app-name",{appName:String(r)});if(t||(t=fr()),!t)throw be.create("no-options");let s=Gt.get(r);if(s){if(ce(t,s.options)&&ce(i,s.config))return s;throw be.create("duplicate-app",{appName:r})}let o=new qt(r);for(let c of Cr.values())o.addComponent(c);let a=new br(t,i,o);return Gt.set(r,a),a}function ze(n=Tr){let e=Gt.get(n);if(!e&&n===Tr&&fr())return kr();if(!e)throw be.create("no-app",{appName:n});return e}function qn(){return Array.from(Gt.values())}function R(n,e,t){var i;let r=(i=fh[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);let s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),me.warn(a.join(" "));return}te(new U(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var mh="firebase-heartbeat-database",gh=1,Kt="firebase-heartbeat-store",Ir=null;function Za(){return Ir||(Ir=Ga(mh,gh,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Kt)}catch(t){console.warn(t)}}}}).catch(n=>{throw be.create("idb-open",{originalErrorMessage:n.message})})),Ir}function vh(n){return f(this,null,function*(){try{let t=(yield Za()).transaction(Kt),i=yield t.objectStore(Kt).get(ec(n));return yield t.done,i}catch(e){if(e instanceof X)me.warn(e.message);else{let t=be.create("idb-get",{originalErrorMessage:e?.message});me.warn(t.message)}}})}function Ja(n,e){return f(this,null,function*(){try{let i=(yield Za()).transaction(Kt,"readwrite");yield i.objectStore(Kt).put(e,ec(n)),yield i.done}catch(t){if(t instanceof X)me.warn(t.message);else{let i=be.create("idb-set",{originalErrorMessage:t?.message});me.warn(i.message)}}})}function ec(n){return`${n.name}!${n.options.appId}`}var yh=1024,Ih=30,Sr=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ar(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return f(this,null,function*(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Qa();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>Ih){let o=wh(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){me.warn(i)}})}getHeartbeatsHeader(){return f(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Qa(),{heartbeatsToSend:i,unsentEntries:r}=Eh(this._heartbeatsCache.heartbeats),s=Bt(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return me.warn(t),""}})}};function Qa(){return new Date().toISOString().substring(0,10)}function Eh(n,e=yh){let t=[],i=n.slice();for(let r of n){let s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),Xa(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Xa(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var Ar=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return f(this,null,function*(){return Hn()?Ma().then(()=>!0).catch(()=>!1):!1})}read(){return f(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield vh(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return f(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Ja(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return f(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Ja(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function Xa(n){return Bt(JSON.stringify({version:2,heartbeats:n})).length}function wh(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}function Th(n){te(new U("platform-logger",e=>new Er(e),"PRIVATE")),te(new U("heartbeat",e=>new Sr(e),"PRIVATE")),R(wr,Ka,n),R(wr,Ka,"esm2017"),R("fire-js","")}Th("");var Ch="firebase",bh="11.9.1";R(Ch,bh,"app");function Sh(n){n||(n=Q(rr));let e=new se(t=>{if(n.destroyed){t.next();return}return n.onDestroy(t.next.bind(t))});return t=>t.pipe(ma(e))}var Rr=class{source;destroyed=!1;destroyRef=Q(rr);constructor(e){this.source=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}subscribe(e){if(this.destroyed)throw new ya(953,!1);let t=this.source.pipe(Sh(this.destroyRef)).subscribe({next:i=>e(i)});return{unsubscribe:()=>t.unsubscribe()}}};function Ty(n,e){return new Rr(n)}function Cy(n){let e=wa(n);return new se(t=>{let i=e?.onDestroy(()=>t.complete()),r=n.subscribe(s=>t.next(s));return()=>{r.unsubscribe(),i?.()}})}function tc(n){n===void 0&&(n=Q(Te));let e=n.get(Un);return t=>new se(i=>{let r=e.add(),s=!1;function o(){s||(r(),s=!0)}let a=t.subscribe({next:c=>{i.next(c),o()},complete:()=>{i.complete(),o()},error:c=>{i.error(c),o()}});return a.add(()=>{i.unsubscribe(),o()}),a})}var Ae=new ga("ANGULARFIRE2_VERSION");function Yt(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Tt=(n,e)=>{let t=e?[e]:qn(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},wt=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(wt||{}),nc=sr()&&typeof Zone<"u"?wt.WARN:wt.SILENT;var Gn=class{zone;delegate;constructor(e,t=ha){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r?r.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,i)}},ke=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Q(oe);this.outsideAngular=t.runOutsideAngular(()=>new Gn(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new Gn(typeof Zone>"u"?void 0:Zone.current,da))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=xn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ic=!1;function kh(n,e){!ic&&(nc>wt.SILENT||sr())&&(ic=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),nc>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function Rh(n){let e=Q(oe,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function qe(n){let e=Q(oe,{optional:!0});return e?e.run(()=>n()):n()}var Ph=(n,e,t)=>(...i)=>(e&&setTimeout(e,0),Fn(t,()=>qe(()=>n.apply(void 0,i)))),D=(n,e,t)=>(t||=e?wt.WARN:wt.VERBOSE,function(){let i,r=arguments,s,o,a;try{s=Q(ke),o=Q(Un),a=Q(Ia)}catch{return kh(n,t),n.apply(this,r)}for(let l=0;l<arguments.length;l++)typeof r[l]=="function"&&(e&&(i||=qe(()=>o.add())),r[l]=Ph(r[l],i,a));let c=Rh(()=>n.apply(this,r));return e?c instanceof se?c.pipe(nr(s.outsideAngular),tr(s.insideAngular),tc(a)):c instanceof Promise?qe(()=>{let l=o.add();return new Promise((u,h)=>{c.then(d=>Fn(a,()=>qe(()=>u(d))),d=>Fn(a,()=>qe(()=>h(d)))).finally(l)})}):typeof c=="function"&&i?function(){return setTimeout(i,0),c.apply(this,arguments)}:qe(()=>c):c instanceof se?c.pipe(nr(s.outsideAngular),tr(s.insideAngular)):qe(()=>c)});var ge=class{constructor(e){return e}},Ge=class{constructor(){return qn()}};function Nh(n){return n&&n.length===1?n[0]:new ge(ze())}var Pr=new ft("angularfire2._apps"),Oh={provide:ge,useFactory:Nh,deps:[[new z,Pr]]},Dh={provide:Ge,deps:[[new z,Pr]]};function Lh(n){return(e,t)=>{let i=t.get(Ea);R("angularfire",Ae.full,"core"),R("angularfire",Ae.full,"app"),R("angular",va.full,i.toString());let r=e.runOutsideAngular(()=>n(t));return new ge(r)}}function Hy(n,...e){return pt([Oh,Dh,{provide:Pr,useFactory:Lh(n),multi:!0,deps:[oe,Te,ke,...e]}])}var jy=D(kr,!0);var Mh=new Map,xh={activated:!1,tokenObservers:[]},Fh={initialized:!1,enabled:!1};function ne(n){return Mh.get(n)||Object.assign({},xh)}function ac(){return Fh}var Uh="https://content-firebaseappcheck.googleapis.com/v1";var Wh="exchangeDebugToken",rc={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},Zy=1440*60*1e3;var Dr=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return f(this,null,function*(){this.stop();try{this.pending=new q,this.pending.promise.catch(t=>{}),yield Vh(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new q,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Vh(n){return new Promise(e=>{setTimeout(e,n)})}var Bh={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Re=new Z("appCheck","AppCheck",Bh);function cc(n){if(!ne(n).activated)throw Re.create("use-before-activation",{appName:n.name})}function lc(i,r){return f(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(p){throw Re.create("fetch-network-error",{originalErrorMessage:p?.message})}if(c.status!==200)throw Re.create("fetch-status-error",{httpStatus:c.status});let l;try{l=yield c.json()}catch(p){throw Re.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=l.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Re.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let h=Number(u[1])*1e3,d=Date.now();return{token:l.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function uc(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${Uh}/projects/${t}/apps/${i}:${Wh}?key=${r}`,body:{debug_token:e}}}var $h="firebase-app-check-database",Hh=1,Lr="firebase-app-check-store";var Kn=null;function jh(){return Kn||(Kn=new Promise((n,e)=>{try{let t=indexedDB.open($h,Hh);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Re.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Lr,{keyPath:"compositeKey"})}}}catch(t){e(Re.create("storage-open",{originalErrorMessage:t?.message}))}}),Kn)}function zh(n,e){return qh(Gh(n),e)}function qh(n,e){return f(this,null,function*(){let i=(yield jh()).transaction(Lr,"readwrite"),s=i.objectStore(Lr).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var l;a(Re.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})})}function Gh(n){return`${n.options.appId}-${n.name}`}var Jt=new le("@firebase/app-check");function Nr(n,e){return Hn()?zh(n,e).catch(t=>{Jt.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function dc(){return ac().enabled}function hc(){return f(this,null,function*(){let n=ac();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Kh={error:"UNKNOWN_ERROR"};function Yh(n){return gt.encodeString(JSON.stringify(n),!1)}function Mr(n,e=!1,t=!1){return f(this,null,function*(){let i=n.app;cc(i);let r=ne(i),s=r.token,o;if(s&&!Qt(s)&&(r.token=void 0,s=void 0),!s){let l=yield r.cachedTokenPromise;l&&(Qt(l)?s=l:yield Nr(i,void 0))}if(!e&&s&&Qt(s))return{token:s.token};let a=!1;if(dc())try{r.exchangeTokenPromise||(r.exchangeTokenPromise=lc(uc(i,yield hc()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);let l=yield r.exchangeTokenPromise;return yield Nr(i,l),r.token=l,{token:l.token}}catch(l){return l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?Jt.warn(l.message):t&&Jt.error(l),Or(l)}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),s=yield ne(i).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?Jt.warn(l.message):t&&Jt.error(l),o=l}let c;return s?o?Qt(s)?c={token:s.token,internalError:o}:c=Or(o):(c={token:s.token},r.token=s,yield Nr(i,s)):c=Or(o),a&&Zh(i,c),c})}function Jh(n){return f(this,null,function*(){let e=n.app;cc(e);let{provider:t}=ne(e);if(dc()){let i=yield hc(),{token:r}=yield lc(uc(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function Qh(n,e,t,i){let{app:r}=n,s=ne(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Qt(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),sc(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>sc(n))}function fc(n,e){let t=ne(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function sc(n){let{app:e}=n,t=ne(e),i=t.tokenRefresher;i||(i=Xh(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function Xh(n){let{app:e}=n;return new Dr(()=>f(null,null,function*(){let t=ne(e),i;if(t.token?i=yield Mr(n,!0):i=yield Mr(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=ne(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-300*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},rc.RETRIAL_MIN_WAIT,rc.RETRIAL_MAX_WAIT)}function Zh(n,e){let t=ne(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Qt(n){return n.expireTimeMillis-Date.now()>0}function Or(n){return{token:Yh(Kh),error:n}}var xr=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ne(this.app);for(let t of e)fc(this.app,t.next);return Promise.resolve()}};function ef(n,e){return new xr(n,e)}function tf(n){return{getToken:e=>Mr(n,e),getLimitedUseToken:()=>Jh(n),addTokenListener:e=>Qh(n,"INTERNAL",e),removeTokenListener:e=>fc(n.app,e)}}var nf="@firebase/app-check",rf="0.10.0";var sf="app-check",oc="app-check-internal";function of(){te(new U(sf,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return ef(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(oc).initialize()})),te(new U(oc,n=>{let e=n.getProvider("app-check").getImmediate();return tf(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),R(nf,rf)}of();var af="app-check";var Ct=class{constructor(){return Tt(af)}};var cf=["localhost","0.0.0.0","127.0.0.1"],hI=typeof window<"u"&&cf.includes(window.location.hostname);function Rc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Pc=Rc,Nc=new Z("auth","Firebase",Rc());var ei=new le("@firebase/auth");function lf(n,...e){ei.logLevel<=b.WARN&&ei.warn(`Auth (${Se}): ${n}`,...e)}function Jn(n,...e){ei.logLevel<=b.ERROR&&ei.error(`Auth (${Se}): ${n}`,...e)}function he(n,...e){throw as(n,...e)}function Ke(n,...e){return as(n,...e)}function Oc(n,e,t){let i=Object.assign(Object.assign({},Pc()),{[e]:t});return new Z("auth","Firebase",i).create(e,{appName:n.name})}function Ie(n){return Oc(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function as(n,...e){if(typeof n!="string"){let t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Nc.create(n,...e)}function g(n,e,...t){if(!n)throw as(e,...t)}function ve(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Jn(e),new Error(e)}function Oe(n,e){n||ve(e)}function Vr(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function uf(){return pc()==="http:"||pc()==="https:"}function pc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function df(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uf()||Da()||"connection"in navigator)?navigator.onLine:!0}function hf(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Ye=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Oe(t>e,"Short delay should be less than long delay!"),this.isMobile=$t()||$n()}get(){return df()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function cs(n,e){Oe(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var ti=class{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ve("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ve("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ve("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var ff={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var pf=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],_f=new Ye(3e4,6e4);function De(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Ee(s,o,a,c){return f(this,arguments,function*(n,e,t,i,r={}){return Dc(n,r,()=>f(null,null,function*(){let l={},u={};i&&(e==="GET"?u=i:l={body:JSON.stringify(i)});let h=He(Object.assign({key:n.config.apiKey},u)).slice(1),d=yield n._getAdditionalHeaders();d["Content-Type"]="application/json",n.languageCode&&(d["X-Firebase-Locale"]=n.languageCode);let p=Object.assign({method:e,headers:d},l);return Oa()||(p.referrerPolicy="no-referrer"),n.emulatorConfig&&Ce(n.emulatorConfig.host)&&(p.credentials="include"),ti.fetch()(yield Lc(n,n.config.apiHost,t,h),p)}))})}function Dc(n,e,t){return f(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},ff),e);try{let r=new Br(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Yn(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Yn(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Yn(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Yn(n,"user-disabled",o);let u=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Oc(n,u,l);he(n,u)}}catch(r){if(r instanceof X)throw r;he(n,"network-request-failed",{message:String(r)})}})}function on(s,o,a,c){return f(this,arguments,function*(n,e,t,i,r={}){let l=yield Ee(n,e,t,i,r);return"mfaPendingCredential"in l&&he(n,"multi-factor-auth-required",{_serverResponse:l}),l})}function Lc(n,e,t,i){return f(this,null,function*(){let r=`${e}${t}?${i}`,s=n,o=s.config.emulator?cs(n.config,r):`${n.config.apiScheme}://${r}`;return pf.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}function mf(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Br=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Ke(this.auth,"network-request-failed")),_f.get())})}};function Yn(n,e,t){let i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);let r=Ke(n,e,i);return r.customData._tokenResponse=t,r}function _c(n){return n!==void 0&&n.enterprise!==void 0}var $r=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return mf(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};function gf(n,e){return f(this,null,function*(){return Ee(n,"GET","/v2/recaptchaConfig",De(n,e))})}function vf(n,e){return f(this,null,function*(){return Ee(n,"POST","/v1/accounts:delete",e)})}function ni(n,e){return f(this,null,function*(){return Ee(n,"POST","/v1/accounts:lookup",e)})}function Zt(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function ls(n,e=!1){return f(this,null,function*(){let t=O(n),i=yield t.getIdToken(e),r=us(i);g(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Zt(Fr(r.auth_time)),issuedAtTime:Zt(Fr(r.iat)),expirationTime:Zt(Fr(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Fr(n){return Number(n)*1e3}function us(n){let[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Jn("JWT malformed, contained fewer than 3 sections"),null;try{let r=_t(t);return r?JSON.parse(r):(Jn("Failed to decode base64 JWT payload"),null)}catch(r){return Jn("Caught error parsing JWT payload as JSON",r?.toString()),null}}function mc(n){let e=us(n);return g(e,"internal-error"),g(typeof e.exp<"u","internal-error"),g(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function bt(n,e,t=!1){return f(this,null,function*(){if(t)return e;try{return yield e}catch(i){throw i instanceof X&&yf(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function yf({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Hr=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>f(this,null,function*(){yield this.iteration()}),t)}iteration(){return f(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var tn=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Zt(this.lastLoginAt),this.creationTime=Zt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ii(n){return f(this,null,function*(){var e;let t=n.auth,i=yield n.getIdToken(),r=yield bt(n,ni(t,{idToken:i}));g(r?.users.length,t,"internal-error");let s=r.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Mc(s.providerUserInfo):[],a=If(n.providerData,o),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!a?.length,u=c?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new tn(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)})}function ds(n){return f(this,null,function*(){let e=O(n);yield ii(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function If(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function Mc(n){return n.map(e=>{var{providerId:t}=e,i=er(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function Ef(n,e){return f(this,null,function*(){let t=yield Dc(n,{},()=>f(null,null,function*(){let i=He({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=yield Lc(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let c={method:"POST",headers:a,body:i};return n.emulatorConfig&&Ce(n.emulatorConfig.host)&&(c.credentials="include"),ti.fetch()(o,c)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function wf(n,e){return f(this,null,function*(){return Ee(n,"POST","/v2/accounts:revokeToken",De(n,e))})}var en=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){g(e.idToken,"internal-error"),g(typeof e.idToken<"u","internal-error"),g(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):mc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){g(e.length!==0,"internal-error");let t=mc(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return f(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(g(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return f(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield Ef(e,t);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){let{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new n;return i&&(g(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(g(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(g(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return ve("not implemented")}};function Pe(n,e){g(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Ne=class n{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=er(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Hr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new tn(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return f(this,null,function*(){let t=yield bt(this,this.stsTokenManager.getToken(this.auth,e));return g(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return ls(this,e)}reload(){return ds(this)}_assign(e){this!==e&&(g(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){g(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return f(this,null,function*(){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield ii(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return f(this,null,function*(){if($(this.auth.app))return Promise.reject(Ie(this.auth));let e=yield this.getIdToken();return yield bt(this,vf(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,l,u;let h=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(r=t.email)!==null&&r!==void 0?r:void 0,p=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,m=(o=t.photoURL)!==null&&o!==void 0?o:void 0,w=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,H=(l=t.createdAt)!==null&&l!==void 0?l:void 0,j=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:J,emailVerified:dt,isAnonymous:la,providerData:Ji,stsTokenManager:ua}=t;g(J&&ua,e,"internal-error");let ud=en.fromJSON(this.name,ua);g(typeof J=="string",e,"internal-error"),Pe(h,e.name),Pe(d,e.name),g(typeof dt=="boolean",e,"internal-error"),g(typeof la=="boolean",e,"internal-error"),Pe(p,e.name),Pe(m,e.name),Pe(w,e.name),Pe(A,e.name),Pe(H,e.name),Pe(j,e.name);let Qi=new n({uid:J,auth:e,email:d,emailVerified:dt,displayName:h,isAnonymous:la,photoURL:m,phoneNumber:p,tenantId:w,stsTokenManager:ud,createdAt:H,lastLoginAt:j});return Ji&&Array.isArray(Ji)&&(Qi.providerData=Ji.map(dd=>Object.assign({},dd))),A&&(Qi._redirectEventId=A),Qi}static _fromIdTokenResponse(e,t,i=!1){return f(this,null,function*(){let r=new en;r.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield ii(s),s})}static _fromGetAccountInfoResponse(e,t,i){return f(this,null,function*(){let r=t.users[0];g(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?Mc(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new en;a.updateFromIdToken(i);let c=new n({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new tn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(c,l),c})}};var gc=new Map;function ye(n){Oe(n instanceof Function,"Expected a class definition");let e=gc.get(n);return e?(Oe(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,gc.set(n,e),e)}var Tf=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return f(this,null,function*(){return!0})}_set(t,i){return f(this,null,function*(){this.storage[t]=i})}_get(t){return f(this,null,function*(){let i=this.storage[t];return i===void 0?null:i})}_remove(t){return f(this,null,function*(){delete this.storage[t]})}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})(),jr=Tf;function Qn(n,e,t){return`firebase:${n}:${e}:${t}`}var ri=class n{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=Qn(this.userKey,r.apiKey,s),this.fullPersistenceKey=Qn("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return f(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield ni(this.auth,{idToken:e}).catch(()=>{});return t?Ne._fromGetAccountInfoResponse(this.auth,t,e):null}return Ne._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return f(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return f(this,null,function*(){if(!t.length)return new n(ye(jr),e,i);let r=(yield Promise.all(t.map(l=>f(null,null,function*(){if(yield l._isAvailable())return l})))).filter(l=>l),s=r[0]||ye(jr),o=Qn(i,e.config.apiKey,e.name),a=null;for(let l of t)try{let u=yield l._get(o);if(u){let h;if(typeof u=="string"){let d=yield ni(e,{idToken:u}).catch(()=>{});if(!d)break;h=yield Ne._fromGetAccountInfoResponse(e,d,u)}else h=Ne._fromJSON(e,u);l!==s&&(a=h),s=l;break}}catch{}let c=r.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new n(s,e,i):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(l=>f(null,null,function*(){if(l!==s)try{yield l._remove(o)}catch{}}))),new n(s,e,i))})}};function vc(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Wc(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(xc(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Bc(e))return"Blackberry";if($c(e))return"Webos";if(Fc(e))return"Safari";if((e.includes("chrome/")||Uc(e))&&!e.includes("edge/"))return"Chrome";if(Vc(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function xc(n=F()){return/firefox\//i.test(n)}function Fc(n=F()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Uc(n=F()){return/crios\//i.test(n)}function Wc(n=F()){return/iemobile/i.test(n)}function Vc(n=F()){return/android/i.test(n)}function Bc(n=F()){return/blackberry/i.test(n)}function $c(n=F()){return/webos/i.test(n)}function hs(n=F()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Cf(n=F()){var e;return hs(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function bf(){return La()&&document.documentMode===10}function Hc(n=F()){return hs(n)||Vc(n)||$c(n)||Bc(n)||/windows phone/i.test(n)||Wc(n)}function jc(n,e=[]){let t;switch(n){case"Browser":t=vc(F());break;case"Worker":t=`${vc(F())}-${n}`;break;default:t=n}let i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Se}/${i}`}var zr=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let i=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return f(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let i of this.queue)yield i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(let r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function Sf(t){return f(this,arguments,function*(n,e={}){return Ee(n,"GET","/v2/passwordPolicy",De(n,e))})}var Af=6,qr=class{constructor(e){var t,i,r,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Af,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsLowercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var Gr=class{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new si(this),this.idTokenSubscription=new si(this),this.beforeStateQueue=new zr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ye(t)),this._initializationPromise=this.queue(()=>f(this,null,function*(){var i,r,s;if(!this._deleted&&(this.persistenceManager=yield ri.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return f(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return f(this,null,function*(){try{let t=yield ni(this,{idToken:e}),i=yield Ne._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return f(this,null,function*(){var t;if($(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),r=i,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return g(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return f(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return f(this,null,function*(){try{yield ii(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=hf()}_delete(){return f(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return f(this,null,function*(){if($(this.app))return Promise.reject(Ie(this));let t=e?O(e):null;return t&&g(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return f(this,null,function*(){if(!this._deleted)return e&&g(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>f(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return f(this,null,function*(){return $(this.app)?Promise.reject(Ie(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return $(this.app)?Promise.reject(Ie(this)):this.queue(()=>f(this,null,function*(){yield this.assertedPersistence.setPersistence(ye(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return f(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return f(this,null,function*(){let e=yield Sf(this),t=new qr(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Z("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let i=this.onAuthStateChanged(()=>{i(),e()},t)}})}revokeAccessToken(e){return f(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),yield wf(this,i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return f(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return f(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ye(e)||this._popupRedirectResolver;g(t,this,"argument-error"),this.redirectPersistenceManager=yield ri.create(this,[ye(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return f(this,null,function*(){var t,i;return this._isInitialized&&(yield this.queue(()=>f(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return f(this,null,function*(){if(e===this.currentUser)return this.queue(()=>f(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(g(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let c=e.addObserver(t,i,r);return()=>{o=!0,c()}}else{let c=e.addObserver(t);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return f(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return g(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return f(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();i&&(t["X-Firebase-Client"]=i);let r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return f(this,null,function*(){var e;if($(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&lf(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Qe(n){return O(n)}var si=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Wa(t=>this.observer=t)}get next(){return g(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var hi={loadJS(){return f(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function kf(n){hi=n}function zc(n){return hi.loadJS(n)}function Rf(){return hi.recaptchaEnterpriseScript}function Pf(){return hi.gapiScript}function qc(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Kr=class{constructor(){this.enterprise=new Yr}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Yr=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var Nf="recaptcha-enterprise",Gc="NO_RECAPTCHA",Jr=class{constructor(e){this.type=Nf,this.auth=Qe(e)}verify(e="verify",t=!1){return f(this,null,function*(){function i(s){return f(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,a)=>f(null,null,function*(){gf(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{let l=new $r(c);return s.tenantId==null?s._agentRecaptchaConfig=l:s._tenantRecaptchaConfigs[s.tenantId]=l,o(l.siteKey)}}).catch(c=>{a(c)})}))})}function r(s,o,a){let c=window.grecaptcha;_c(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(l=>{o(l)}).catch(()=>{o(Gc)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Kr().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{i(this.auth).then(a=>{if(!t&&_c(window.grecaptcha))r(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Rf();c.length!==0&&(c+=a),zc(c).then(()=>{r(a,s,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})})}};function Xt(n,e,t,i=!1,r=!1){return f(this,null,function*(){let s=new Jr(n),o;if(r)o=Gc;else try{o=yield s.verify(t)}catch{o=yield s.verify(t,!0)}let a=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){let c=a.phoneEnrollmentInfo.phoneNumber,l=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a})}function Qr(n,e,t,i,r){return f(this,null,function*(){var s,o;if(r==="EMAIL_PASSWORD_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let a=yield Xt(n,e,t,t==="getOobCode");return i(n,a)}else return i(n,e).catch(a=>f(null,null,function*(){if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let c=yield Xt(n,e,t,t==="getOobCode");return i(n,c)}else return Promise.reject(a)}));else if(r==="PHONE_PROVIDER")if(!((o=n._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){let a=yield Xt(n,e,t);return i(n,a).catch(c=>f(null,null,function*(){var l;if(((l=n._getRecaptchaConfig())===null||l===void 0?void 0:l.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let u=yield Xt(n,e,t,!1,!0);return i(n,u)}return Promise.reject(c)}))}else{let a=yield Xt(n,e,t,!1,!0);return i(n,a)}else return Promise.reject(r+" provider is not supported.")})}function fs(n,e){let t=Et(n,"auth");if(t.isInitialized()){let r=t.getImmediate(),s=t.getOptions();if(ce(s,e??{}))return r;he(r,"already-initialized")}return t.initialize({options:e})}function Of(n,e){let t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(ye);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}function ps(n,e,t){let i=Qe(n);g(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");let r=!!t?.disableWarnings,s=Kc(e),{host:o,port:a}=Df(e),c=a===null?"":`:${a}`,l={url:`${s}//${o}${c}/`},u=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){g(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),g(ce(l,i.config.emulator)&&ce(u,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=u,i.settings.appVerificationDisabledForTesting=!0,Ce(o)?(Vn(`${s}//${o}${c}`),Bn("Auth",!0)):r||Lf()}function Kc(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Df(n){let e=Kc(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let s=r[1];return{host:s,port:yc(i.substr(s.length+1))}}else{let[s,o]=i.split(":");return{host:s,port:yc(o)}}}function yc(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function Lf(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var nn=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ve("not implemented")}_getIdTokenResponse(e){return ve("not implemented")}_linkToIdToken(e,t){return ve("not implemented")}_getReauthenticationResolver(e){return ve("not implemented")}};function Mf(n,e){return f(this,null,function*(){return Ee(n,"POST","/v1/accounts:signUp",e)})}function xf(n,e){return f(this,null,function*(){return on(n,"POST","/v1/accounts:signInWithPassword",De(n,e))})}function Ff(n,e){return f(this,null,function*(){return on(n,"POST","/v1/accounts:signInWithEmailLink",De(n,e))})}function Uf(n,e){return f(this,null,function*(){return on(n,"POST","/v1/accounts:signInWithEmailLink",De(n,e))})}var rn=class n extends nn{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new n(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return f(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qr(e,t,"signInWithPassword",xf,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Ff(e,{email:this._email,oobCode:this._password});default:he(e,"internal-error")}})}_linkToIdToken(e,t){return f(this,null,function*(){switch(this.signInMethod){case"password":let i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qr(e,i,"signUpPassword",Mf,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Uf(e,{idToken:t,email:this._email,oobCode:this._password});default:he(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function Ur(n,e){return f(this,null,function*(){return on(n,"POST","/v1/accounts:signInWithIdp",De(n,e))})}function Wf(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Vf(n){let e=vt(yt(n)).link,t=e?vt(yt(e)).deep_link_id:null,i=vt(yt(n)).deep_link_id;return(i?vt(yt(i)).link:null)||i||t||e||n}var oi=class n{constructor(e){var t,i,r,s,o,a;let c=vt(yt(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(i=c.oobCode)!==null&&i!==void 0?i:null,h=Wf((r=c.mode)!==null&&r!==void 0?r:null);g(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.lang)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let t=Vf(e);try{return new n(t)}catch{return null}}};var Yc=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,i){return rn._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){let r=oi.parseLink(i);return g(r,"argument-error"),rn._fromEmailAndCode(t,r.code,r.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),ai=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Xr=class extends ai{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function Bf(n,e){return f(this,null,function*(){return on(n,"POST","/v1/accounts:signUp",De(n,e))})}var St=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,i,r=!1){return f(this,null,function*(){let s=yield Ne._fromIdTokenResponse(e,i,r),o=Ic(i);return new n({user:s,providerId:o,_tokenResponse:i,operationType:t})})}static _forOperation(e,t,i){return f(this,null,function*(){yield e._updateTokensIfNecessary(i,!0);let r=Ic(i);return new n({user:e,providerId:r,_tokenResponse:i,operationType:t})})}};function Ic(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var Zr=class n extends X{constructor(e,t,i,r){var s;super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new n(e,t,i,r)}};function Jc(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Zr._fromErrorAndOperation(n,s,e,i):s})}function $f(n,e,t=!1){return f(this,null,function*(){let i=yield bt(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return St._forOperation(n,"link",i)})}function Hf(n,e,t=!1){return f(this,null,function*(){let{auth:i}=n;if($(i.app))return Promise.reject(Ie(i));let r="reauthenticate";try{let s=yield bt(n,Jc(i,r,e,n),t);g(s.idToken,i,"internal-error");let o=us(s.idToken);g(o,i,"internal-error");let{sub:a}=o;return g(n.uid===a,i,"user-mismatch"),St._forOperation(n,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&he(i,"user-mismatch"),s}})}function Qc(n,e,t=!1){return f(this,null,function*(){if($(n.app))return Promise.reject(Ie(n));let i="signIn",r=yield Jc(n,i,e),s=yield St._fromIdTokenResponse(n,i,r);return t||(yield n._updateCurrentUser(s.user)),s})}function _s(n,e){return f(this,null,function*(){return Qc(Qe(n),e)})}function Xc(n){return f(this,null,function*(){let e=Qe(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function ms(n,e,t){return f(this,null,function*(){if($(n.app))return Promise.reject(Ie(n));let i=Qe(n),o=yield Qr(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Bf,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&Xc(n),c}),a=yield St._fromIdTokenResponse(i,"signIn",o);return yield i._updateCurrentUser(a.user),a})}function gs(n,e,t){return $(n.app)?Promise.reject(Ie(n)):_s(O(n),Yc.credential(e,t)).catch(i=>f(null,null,function*(){throw i.code==="auth/password-does-not-meet-requirements"&&Xc(n),i}))}function jf(n,e){return f(this,null,function*(){return Ee(n,"POST","/v1/accounts:update",e)})}function vs(i,r){return f(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=O(n),a={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},c=yield bt(s,jf(s.auth,a));s.displayName=c.displayName||null,s.photoURL=c.photoUrl||null;let l=s.providerData.find(({providerId:u})=>u==="password");l&&(l.displayName=s.displayName,l.photoURL=s.photoURL),yield s._updateTokensIfNecessary(c)})}function ys(n,e,t,i){return O(n).onIdTokenChanged(e,t,i)}function Is(n,e,t){return O(n).beforeAuthStateChanged(e,t)}function Es(n){return O(n).signOut()}var ci="__sak";var li=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ci,"1"),this.storage.removeItem(ci),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var zf=1e3,qf=10,Gf=(()=>{class n extends li{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Hc(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),s=this.localCache[i];r!==s&&t(i,s,r)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((a,c,l)=>{this.notifyListeners(a,l)});return}let r=t.key;i?this.detachListener():this.stopPolling();let s=()=>{let a=this.storage.getItem(r);!i&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);bf()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,qf):s()}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:r}),!0)})},zf)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,i){return f(this,null,function*(){yield Ve(n.prototype,this,"_set").call(this,t,i),this.localCache[t]=JSON.stringify(i)})}_get(t){return f(this,null,function*(){let i=yield Ve(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(i),i})}_remove(t){return f(this,null,function*(){yield Ve(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),Zc=Gf;var Kf=(()=>{class n extends li{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}return n.type="SESSION",n})(),ws=Kf;function Yf(n){return Promise.all(n.map(e=>f(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Jf=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let i=this.receivers.find(s=>s.isListeningto(t));if(i)return i;let r=new n(t);return this.receivers.push(r),r}isListeningto(t){return this.eventTarget===t}handleEvent(t){return f(this,null,function*(){let i=t,{eventId:r,eventType:s,data:o}=i.data,a=this.handlersMap[s];if(!a?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let c=Array.from(a).map(u=>f(this,null,function*(){return u(i.origin,o)})),l=yield Yf(c);i.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function el(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}var es=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,i=50){return f(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{let l=el("",20);r.port1.start();let u=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(h){let d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(d.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function de(){return window}function Qf(n){de().location.href=n}function tl(){return typeof de().WorkerGlobalScope<"u"&&typeof de().importScripts=="function"}function Xf(){return f(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Zf(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function ep(){return tl()?self:null}var nl="firebaseLocalStorageDb",tp=1,ui="firebaseLocalStorage",il="fbase_key",Je=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function fi(n,e){return n.transaction([ui],e?"readwrite":"readonly").objectStore(ui)}function np(){let n=indexedDB.deleteDatabase(nl);return new Je(n).toPromise()}function ts(){let n=indexedDB.open(nl,tp);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore(ui,{keyPath:il})}catch(r){t(r)}}),n.addEventListener("success",()=>f(null,null,function*(){let i=n.result;i.objectStoreNames.contains(ui)?e(i):(i.close(),yield np(),e(yield ts()))}))})}function Ec(n,e,t){return f(this,null,function*(){let i=fi(n,!0).put({[il]:e,value:t});return new Je(i).toPromise()})}function ip(n,e){return f(this,null,function*(){let t=fi(n,!1).get(e),i=yield new Je(t).toPromise();return i===void 0?null:i.value})}function wc(n,e){let t=fi(n,!0).delete(e);return new Je(t).toPromise()}var rp=800,sp=3,op=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return f(this,null,function*(){return this.db?this.db:(this.db=yield ts(),this.db)})}_withRetries(t){return f(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield t(r)}catch(r){if(i++>sp)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return f(this,null,function*(){return tl()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return f(this,null,function*(){this.receiver=Jf._getInstance(ep()),this.receiver._subscribe("keyChanged",(t,i)=>f(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(t,i)=>f(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return f(this,null,function*(){var t,i;if(this.activeServiceWorker=yield Xf(),!this.activeServiceWorker)return;this.sender=new es(this.activeServiceWorker);let r=yield this.sender._send("ping",{},800);r&&!((t=r[0])===null||t===void 0)&&t.fulfilled&&!((i=r[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return f(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Zf()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return f(this,null,function*(){try{if(!indexedDB)return!1;let t=yield ts();return yield Ec(t,ci,"1"),yield wc(t,ci),!0}catch{}return!1})}_withPendingWrite(t){return f(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,i){return f(this,null,function*(){return this._withPendingWrite(()=>f(this,null,function*(){return yield this._withRetries(r=>Ec(r,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)}))})}_get(t){return f(this,null,function*(){let i=yield this._withRetries(r=>ip(r,t));return this.localCache[t]=i,i})}_remove(t){return f(this,null,function*(){return this._withPendingWrite(()=>f(this,null,function*(){return yield this._withRetries(i=>wc(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return f(this,null,function*(){let t=yield this._withRetries(s=>{let o=fi(s,!1).getAll();return new Je(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),i.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),i.push(s));return i})}notifyListeners(t,i){this.localCache[t]=i;let r=this.listeners[t];if(r)for(let s of Array.from(r))s(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>f(this,null,function*(){return this._poll()}),rp)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),rl=op;var II=qc("rcb"),EI=new Ye(3e4,6e4);function ap(n,e){return e?ye(e):(g(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var sn=class extends nn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ur(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ur(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ur(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function cp(n){return Qc(n.auth,new sn(n),n.bypassAuthState)}function lp(n){let{auth:e,user:t}=n;return g(t,e,"internal-error"),Hf(t,new sn(n),n.bypassAuthState)}function up(n){return f(this,null,function*(){let{auth:e,user:t}=n;return g(t,e,"internal-error"),$f(t,new sn(n),n.bypassAuthState)})}var ns=class{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>f(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(e){return f(this,null,function*(){let{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(c))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cp;case"linkViaPopup":case"linkViaRedirect":return up;case"reauthViaPopup":case"reauthViaRedirect":return lp;default:he(this.auth,"internal-error")}}resolve(e){Oe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Oe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var wI=new Ye(2e3,1e4);var dp="pendingRedirect",Xn=new Map,is=class n extends ns{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}execute(){return f(this,null,function*(){let e=Xn.get(this.auth._key());if(!e){try{let i=(yield hp(this.resolver,this.auth))?yield Ve(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Xn.set(this.auth._key(),e)}return this.bypassAuthState||Xn.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return f(this,null,function*(){if(e.type==="signInViaRedirect")return Ve(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Ve(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return f(this,null,function*(){})}cleanUp(){}};function hp(n,e){return f(this,null,function*(){let t=_p(e),i=pp(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(t))==="true";return yield i._remove(t),r})}function fp(n,e){Xn.set(n._key(),e)}function pp(n){return ye(n._redirectPersistence)}function _p(n){return Qn(dp,n.config.apiKey,n.name)}function mp(n,e,t=!1){return f(this,null,function*(){if($(n.app))return Promise.reject(Ie(n));let i=Qe(n),r=ap(i,e),o=yield new is(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,e)),o})}var gp=600*1e3,rs=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!vp(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!sl(e)){let r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(Ke(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=gp&&this.cachedEventUids.clear(),this.cachedEventUids.has(Tc(e))}saveEventToCache(e){this.cachedEventUids.add(Tc(e)),this.lastProcessedEventTime=Date.now()}};function Tc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function sl({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function vp(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sl(n);default:return!1}}function yp(t){return f(this,arguments,function*(n,e={}){return Ee(n,"GET","/v1/projects",e)})}var Ip=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ep=/^https?/;function wp(n){return f(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield yp(n);for(let t of e)try{if(Tp(t))return}catch{}he(n,"unauthorized-domain")})}function Tp(n){let e=Vr(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!Ep.test(t))return!1;if(Ip.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var Cp=new Ye(3e4,6e4);function Cc(){let n=de().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function bp(n){return new Promise((e,t)=>{var i,r,s;function o(){Cc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Cc(),t(Ke(n,"network-request-failed"))},timeout:Cp.get()})}if(!((r=(i=de().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((s=de().gapi)===null||s===void 0)&&s.load)o();else{let a=qc("iframefcb");return de()[a]=()=>{gapi.load?o():t(Ke(n,"network-request-failed"))},zc(`${Pf()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Zn=null,e})}var Zn=null;function Sp(n){return Zn=Zn||bp(n),Zn}var Ap=new Ye(5e3,15e3),kp="__/auth/iframe",Rp="emulator/auth/iframe",Pp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Np=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Op(n){let e=n.config;g(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?cs(e,Rp):`https://${n.config.authDomain}/${kp}`,i={apiKey:e.apiKey,appName:n.name,v:Se},r=Np.get(n.config.apiHost);r&&(i.eid=r);let s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${He(i).slice(1)}`}function Dp(n){return f(this,null,function*(){let e=yield Sp(n),t=de().gapi;return g(t,n,"internal-error"),e.open({where:document.body,url:Op(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Pp,dontclear:!0},i=>new Promise((r,s)=>f(null,null,function*(){yield i.restyle({setHideOnLeave:!1});let o=Ke(n,"network-request-failed"),a=de().setTimeout(()=>{s(o)},Ap.get());function c(){de().clearTimeout(a),r(i)}i.ping(c).then(c,()=>{s(o)})})))})}var Lp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Mp=500,xp=600,Fp="_blank",Up="http://localhost",di=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function Wp(n,e,t,i=Mp,r=xp){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",c=Object.assign(Object.assign({},Lp),{width:i.toString(),height:r.toString(),top:s,left:o}),l=F().toLowerCase();t&&(a=Uc(l)?Fp:t),xc(l)&&(e=e||Up,c.scrollbars="yes");let u=Object.entries(c).reduce((d,[p,m])=>`${d}${p}=${m},`,"");if(Cf(l)&&a!=="_self")return Vp(e||"",a),new di(null);let h=window.open(e||"",a,u);g(h,n,"popup-blocked");try{h.focus()}catch{}return new di(h)}function Vp(n,e){let t=document.createElement("a");t.href=n,t.target=e;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}var Bp="__/auth/handler",$p="emulator/auth/handler",Hp=encodeURIComponent("fac");function bc(n,e,t,i,r,s){return f(this,null,function*(){g(n.config.authDomain,n,"auth-domain-config-required"),g(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Se,eventId:r};if(e instanceof ai){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Ht(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[u,h]of Object.entries(s||{}))o[u]=h}if(e instanceof Xr){let u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);let a=o;for(let u of Object.keys(a))a[u]===void 0&&delete a[u];let c=yield n._getAppCheckToken(),l=c?`#${Hp}=${encodeURIComponent(c)}`:"";return`${jp(n)}?${He(a).slice(1)}${l}`})}function jp({config:n}){return n.emulator?cs(n,$p):`https://${n.authDomain}/${Bp}`}var Wr="webStorageSupport",ss=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ws,this._completeRedirectFn=mp,this._overrideRedirectResult=fp}_openPopup(e,t,i,r){return f(this,null,function*(){var s;Oe((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield bc(e,t,i,Vr(),r);return Wp(e,o,el())})}_openRedirect(e,t,i,r){return f(this,null,function*(){yield this._originValidation(e);let s=yield bc(e,t,i,Vr(),r);return Qf(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Oe(s,"If manager is not set, promise should be"),s)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}initAndGetManager(e){return f(this,null,function*(){let t=yield Dp(e),i=new rs(e);return t.register("authEvent",r=>(g(r?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Wr,{type:Wr},r=>{var s;let o=(s=r?.[0])===null||s===void 0?void 0:s[Wr];o!==void 0&&t(!!o),he(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=wp(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Hc()||Fc()||hs()}},ol=ss;var Sc="@firebase/auth",Ac="1.10.7";var os=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return f(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){g(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function zp(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qp(n){te(new U("auth",(e,{options:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;g(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jc(n)},l=new Gr(i,r,s,c);return Of(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),te(new U("auth-internal",e=>{let t=Qe(e.getProvider("auth").getImmediate());return(i=>new os(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),R(Sc,Ac,zp(n)),R(Sc,Ac,"esm2017")}var Gp=300,Kp=pr("authIdTokenMaxAge")||Gp,kc=null,Yp=n=>e=>f(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>Kp)return;let r=t?.token;kc!==r&&(kc=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function Ts(n=ze()){let e=Et(n,"auth");if(e.isInitialized())return e.getImmediate();let t=fs(n,{popupRedirectResolver:ol,persistence:[rl,Zc,ws]}),i=pr("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(i,location.origin);if(location.origin===s.origin){let o=Yp(s.toString());Is(t,o,()=>o(t.currentUser)),ys(t,a=>o(a))}}let r=hr("auth");return r&&ps(t,`http://${r}`),t}function Jp(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}kf({loadJS(n){return new Promise((e,t)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{let s=Ke("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",Jp().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});qp("Browser");var al="auth",Xe=class{constructor(e){return e}},an=class{constructor(){return Tt(al)}};var Cs=new ft("angularfire2.auth-instances");function U_(n,e){let t=Yt(al,n,e);return t&&new Xe(t)}function W_(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Xe(i)}}var V_={provide:an,deps:[[new z,Cs]]},B_={provide:Xe,useFactory:U_,deps:[[new z,Cs],ge]};function cE(n,...e){return R("angularfire",Ae.full,"auth"),pt([B_,V_,{provide:Cs,useFactory:W_(n),multi:!0,deps:[oe,Te,ke,Ge,[new z,Ct],...e]}])}var cl=D(ms,!0,2);var lE=D(Ts,!0);var ll=D(gs,!0,2);var ul=D(Es,!0,2);var dl=D(vs,!0,2);var hl="@firebase/database",fl="1.0.19";var Oo="";function H_(n){Oo=n}var Os=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),N(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:mt(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Ds=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ee(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var zl=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Os(e)}}catch{}return new Ds},et=zl("localStorage"),Ls=zl("sessionStorage");var Rt=new le("@firebase/database"),j_=(function(){let n=1;return function(){return n++}})(),ql=function(n){let e=Va(n),t=new Wn;t.update(e);let i=t.digest();return gt.encodeByteArray(i)},kn=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=kn.apply(null,i):typeof i=="object"?e+=N(i):e+=i,e+=" "}return e},tt=null,pl=!0,z_=function(n,e){_(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Rt.logLevel=b.VERBOSE,tt=Rt.log.bind(Rt),e&&Ls.set("logging_enabled",!0)):typeof n=="function"?tt=n:(tt=null,Ls.remove("logging_enabled"))},M=function(...n){if(pl===!0&&(pl=!1,tt===null&&Ls.get("logging_enabled")===!0&&z_(!0)),tt){let e=kn.apply(null,n);tt(e)}},Rn=function(n){return function(...e){M(n,...e)}},Ms=function(...n){let e="FIREBASE INTERNAL ERROR: "+kn(...n);Rt.error(e)},we=function(...n){let e=`FIREBASE FATAL ERROR: ${kn(...n)}`;throw Rt.error(e),new Error(e)},V=function(...n){let e="FIREBASE WARNING: "+kn(...n);Rt.warn(e)},q_=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&V("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Do=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},G_=function(n){if(ae()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},it="[MIN_NAME]",Fe="[MAX_NAME]",ct=function(n,e){if(n===e)return 0;if(n===it||e===Fe)return-1;if(e===it||n===Fe)return 1;{let t=_l(n),i=_l(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},K_=function(n,e){return n===e?0:n<e?-1:1},cn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+N(e))},Lo=function(n){if(typeof n!="object"||n===null)return N(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=N(e[i]),t+=":",t+=Lo(n[e[i]]);return t+="}",t},Gl=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function x(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Kl=function(n){_(!Do(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(r?1:0),l.reverse();let u=l.join(""),h="";for(c=0;c<64;c+=8){let d=parseInt(u.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Y_=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},J_=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Q_(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var X_=new RegExp("^-?(0*)\\d{1,10}$"),Z_=-2147483648,em=2147483647,_l=function(n){if(X_.test(n)){let e=Number(n);if(e>=Z_&&e<=em)return e}return null},Ft=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw V("Exception was thrown by user callback.",t),e},Math.floor(0))}},tm=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},fn=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var xs=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,$(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){V(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Fs=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(M("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',V(e)}},pn=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),_i="5",Yl="v",Jl="s",Ql="r",Xl="f",Zl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,eu="ls",tu="p",Us="ac",nu="websocket",iu="long_polling";var mi=class{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1,l=null){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=et.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&et.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function nm(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ru(n,e,t){_(typeof e=="string","typeof type must == string"),_(typeof t=="object","typeof params must == object");let i;if(e===nu)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===iu)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);nm(n)&&(t.ns=n.namespace);let r=[];return x(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var Ws=class{constructor(){this.counters_={}}incrementCounter(e,t=1){ee(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Aa(this.counters_)}};var bs={},Ss={};function Mo(n){let e=n.toString();return bs[e]||(bs[e]=new Ws),bs[e]}function im(n,e){let t=n.toString();return Ss[t]||(Ss[t]=e()),Ss[t]}var Vs=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Ft(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var ml="start",rm="close",sm="pLPCommand",om="pRTLPCB",su="id",ou="pw",au="ser",am="cb",cm="seg",lm="ts",um="d",dm="dframe",cu=1870,lu=30,hm=cu-lu,fm=25e3,pm=3e4,Bs=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Rn(e),this.stats_=Mo(t),this.urlFn=c=>(this.appCheckToken&&(c[Us]=this.appCheckToken),ru(t,iu,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Vs(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pm)),G_(()=>{if(this.isClosed_)return;this.scriptTagHolder=new $s((...s)=>{let[o,a,c,l,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ml)this.id=a,this.password=c;else if(o===rm)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[ml]="t",i[au]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[am]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Yl]=_i,this.transportSessionId&&(i[Jl]=this.transportSessionId),this.lastSessionId&&(i[eu]=this.lastSessionId),this.applicationId&&(i[tu]=this.applicationId),this.appCheckToken&&(i[Us]=this.appCheckToken),typeof location<"u"&&location.hostname&&Zl.test(location.hostname)&&(i[Ql]=Xl);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return ae()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Y_()&&!J_()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=N(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=ur(t),r=Gl(i,hm);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ae())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[dm]="t",i[su]=e,i[ou]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=N(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},$s=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ae())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=j_(),window[sm+this.uniqueCallbackIdentifier]=e,window[om+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){M("frame writing exception"),a.stack&&M(a.stack),M(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||M("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[su]=this.myID,e[ou]=this.myPW,e[au]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+lu+i.length<=cu;){let o=this.pendingSegs.shift();i=i+"&"+cm+r+"="+o.seg+"&"+lm+r+"="+o.ts+"&"+um+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(fm)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){ae()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{M("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var _m=16384,mm=45e3,gi=null;typeof MozWebSocket<"u"?gi=MozWebSocket:typeof WebSocket<"u"&&(gi=WebSocket);var ln=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Rn(this.connId),this.stats_=Mo(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[Yl]=_i,!ae()&&typeof location<"u"&&location.hostname&&Zl.test(location.hostname)&&(a[Ql]=Xl),i&&(a[Jl]=i),r&&(a[eu]=r),s&&(a[Us]=s),o&&(a[tu]=o),ru(t,nu,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,et.set("previous_websocket_failure",!0);try{let r;if(ae()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${_i}/${Oo}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new gi(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&gi!==null&&!n.forceDisallow_}static previouslyFailed(){return et.isInMemoryStorage||et.get("previous_websocket_failure")===!0}markConnectionHealthy(){et.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=mt(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(_(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=N(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=Gl(i,_m);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(mm))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),gm=(()=>{class n{static get ALL_TRANSPORTS(){return[Bs,ln]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let i=ln&&ln.isAvailable(),r=i&&!ln.previouslyFailed();if(t.webSocketOnly&&(i||V("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ln];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),vm=6e4,ym=5e3,Im=10*1024,Em=100*1024,As="t",gl="d",wm="s",vl="r",Tm="e",yl="o",Il="a",El="n",wl="p",Cm="h",Hs=class{constructor(e,t,i,r,s,o,a,c,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Rn("c:"+this.id+":"),this.transportManager_=new gm(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=fn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Em?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Im?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(As in e){let t=e[As];t===Il?this.upgradeIfSecondaryHealthy_():t===vl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===yl&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=cn("t",e),i=cn("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:wl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Il,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:El,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=cn("t",e),i=cn("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=cn(As,e);if(gl in e){let i=e[gl];if(t===Cm){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===El){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===wm?this.onConnectionShutdown_(i):t===vl?this.onReset_(i):t===Tm?Ms("Server Error: "+i):t===yl?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ms("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),_i!==i&&V("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),fn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(vm))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):fn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(ym))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:wl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(et.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var vi=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var yi=class{constructor(e){this.allowedEvents_=e,this.listeners_={},_(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){_(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Ii=class n extends yi{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!$t()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return _(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Tl=32,Cl=768,C=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function T(){return new C("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ue(n){return n.pieces_.length-n.pieceNum_}function S(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new C(n.pieces_,e)}function xo(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function bm(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function vn(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function uu(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new C(e,0)}function P(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof C)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new C(t,0)}function I(n){return n.pieceNum_>=n.pieces_.length}function W(n,e){let t=y(n),i=y(e);if(t===null)return e;if(t===i)return W(S(n),S(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Sm(n,e){let t=vn(n,0),i=vn(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=ct(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function Fo(n,e){if(Ue(n)!==Ue(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function G(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Ue(n)>Ue(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var js=class{constructor(e,t){this.errorPrefix_=t,this.parts_=vn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=zt(this.parts_[i]);du(this)}};function Am(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=zt(e),du(n)}function km(n){let e=n.parts_.pop();n.byteLength_-=zt(e),n.parts_.length>0&&(n.byteLength_-=1)}function du(n){if(n.byteLength_>Cl)throw new Error(n.errorPrefix_+"has a key path longer than "+Cl+" bytes ("+n.byteLength_+").");if(n.parts_.length>Tl)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Tl+") or object contains a cycle "+Ze(n))}function Ze(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var zs=class n extends yi{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return _(e==="visible","Unknown event type: "+e),[this.visible_]}};var un=1e3,Rm=300*1e3,bl=30*1e3,Pm=1.3,Nm=3e4,Om="server_kill",Sl=3,Uo=(()=>{class n extends vi{constructor(t,i,r,s,o,a,c,l){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=n.nextPersistentConnectionId_++,this.log_=Rn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=un,this.maxReconnectDelay_=Rm,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!ae())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");zs.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Ii.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(N(o)),_(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new q,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),_(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let l=c.d,u=c.s;n.warnOnListenWarnings_(l,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),u!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(u,l))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&ee(t,"w")){let r=$e(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();V(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Ua(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=bl)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=Fa(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),_(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+N(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):Ms("Unrecognized action received from server: "+N(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){_(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=un,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=un,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Nm&&(this.reconnectDelay_=un),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Pm)}this.onConnectStatus_(!1)}establishConnection_(){return f(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,l=function(){c?c.close():(a=!0,r())},u=function(d){_(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(d)};this.realtime_={close:l,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,p]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?M("getToken() completed but was canceled"):(M("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,c=new Hs(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,m=>{V(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(Om)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&V(d),l())}}})}interrupt(t){M("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){M("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ht(this.interruptReasons_)&&(this.reconnectDelay_=un,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>Lo(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new C(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){M("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Sl&&(this.reconnectDelay_=bl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){M("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Sl&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";ae()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+Oo.replace(/\./g,"-")]=1,$t()?t["framework.cordova"]=1:$n()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Ii.getInstance().currentlyOnline();return Ht(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),E=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Pt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new E(it,e),r=new E(it,t);return this.compare(i,r)!==0}minPost(){return E.MIN}};var pi,Ei=class extends Pt{static get __EMPTY_NODE(){return pi}static set __EMPTY_NODE(e){pi=e}compare(e,t){return ct(e.name,t.name)}isDefinedOn(e){throw Be("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return E.MIN}maxPost(){return new E(Fe,pi)}makePost(e,t){return _(typeof e=="string","KeyIndex indexValue must always be a string."),new E(e,pi)}toString(){return".key"}},nt=new Ei;var kt=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},ie=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??K.EMPTY_NODE,this.right=o??K.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return K.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return K.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),qs=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new ie(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},K=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ie.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ie.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new kt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new kt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new kt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new kt(this.root_,null,this.comparator_,!0,e)}};K.EMPTY_NODE=new qs;function Dm(n,e){return ct(n.name,e.name)}function Wo(n,e){return ct(n,e)}var Gs;function Lm(n){Gs=n}var hu=function(n){return typeof n=="number"?"number:"+Kl(n):"string:"+n},fu=function(n){if(n.isLeafNode()){let e=n.val();_(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ee(e,".sv"),"Priority must be a string or number.")}else _(n===Gs||n.isEmpty(),"priority of unexpected type.");_(n===Gs||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Al,Nt=(()=>{class n{static set __childrenNodeConstructor(t){Al=t}static get __childrenNodeConstructor(){return Al}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,_(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),fu(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return I(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=y(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(_(r!==".priority"||Ue(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(S(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+hu(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=Kl(this.value_):t+=this.value_,this.lazyHash_=ql(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(_(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return _(s>=0,"Unknown leaf type: "+i),_(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),pu,_u;function Mm(n){pu=n}function xm(n){_u=n}var Ks=class extends Pt{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?ct(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return E.MIN}maxPost(){return new E(Fe,new Nt("[PRIORITY-POST]",_u))}makePost(e,t){let i=pu(e);return new E(t,new Nt("[PRIORITY-POST]",i))}toString(){return".priority"}},k=new Ks;var Fm=Math.log(2),Ys=class{constructor(e){let t=s=>parseInt(Math.log(s)/Fm,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},wi=function(n,e,t,i){n.sort(e);let r=function(c,l){let u=l-c,h,d;if(u===0)return null;if(u===1)return h=n[c],d=t?t(h):h,new ie(d,h.node,ie.BLACK,null,null);{let p=parseInt(u/2,10)+c,m=r(c,p),w=r(p+1,l);return h=n[p],d=t?t(h):h,new ie(d,h.node,ie.BLACK,m,w)}},s=function(c){let l=null,u=null,h=n.length,d=function(m,w){let A=h-m,H=h;h-=m;let j=r(A+1,H),J=n[A],dt=t?t(J):J;p(new ie(dt,J.node,w,null,j))},p=function(m){l?(l.left=m,l=m):(u=m,l=m)};for(let m=0;m<c.count;++m){let w=c.nextBitIsOne(),A=Math.pow(2,c.count-(m+1));w?d(A,ie.BLACK):(d(A,ie.BLACK),d(A,ie.RED))}return u},o=new Ys(n.length),a=s(o);return new K(i||e,a)};var ks,At={},Ot=class n{static get Default(){return _(At&&k,"ChildrenNode.ts has not been loaded"),ks=ks||new n({".priority":At},{".priority":k}),ks}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=$e(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof K?t:null}hasIndex(e){return ee(this.indexSet_,e.toString())}addIndex(e,t){_(e!==nt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(E.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=wi(i,e.getCompare()):a=At;let c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;let u=Object.assign({},this.indexes_);return u[c]=a,new n(u,l)}addToIndexes(e,t){let i=jt(this.indexes_,(r,s)=>{let o=$e(this.indexSet_,s);if(_(o,"Missing index implementation for "+s),r===At)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(E.Wrap),l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),wi(a,o.getCompare())}else return At;else{let a=t.get(e.name),c=r;return a&&(c=c.remove(new E(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=jt(this.indexes_,r=>{if(r===At)return r;{let s=t.get(e.name);return s?r.remove(new E(e.name,s)):r}});return new n(i,this.indexSet_)}};var dn,v=(()=>{class n{static get EMPTY_NODE(){return dn||(dn=new n(new K(Wo),null,Ot.Default))}constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&fu(this.priorityNode_),this.children_.isEmpty()&&_(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||dn}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?dn:i}}getChild(t){let i=y(t);return i===null?this:this.getImmediateChild(i).getChild(S(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(_(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new E(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?dn:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=y(t);if(r===null)return i;{_(y(t)!==".priority"||Ue(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(S(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(k,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+hu(this.getPriority().val())+":"),this.forEachChild(k,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":ql(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new E(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new E(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new E(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,E.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,E.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Pn?-1:0}withIndex(t){if(t===nt||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===nt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(k),s=i.getIterator(k),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===nt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Js=class extends v{constructor(){super(new K(Wo),v.EMPTY_NODE,Ot.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return v.EMPTY_NODE}isEmpty(){return!1}},Pn=new Js;Object.defineProperties(E,{MIN:{value:new E(it,v.EMPTY_NODE)},MAX:{value:new E(Fe,Pn)}});Ei.__EMPTY_NODE=v.EMPTY_NODE;Nt.__childrenNodeConstructor=v;Lm(Pn);xm(Pn);var Um=!0;function L(n,e=null){if(n===null)return v.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),_(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Nt(t,L(e))}if(!(n instanceof Array)&&Um){let t=[],i=!1;if(x(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=L(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new E(o,c)))}}),t.length===0)return v.EMPTY_NODE;let s=wi(t,Dm,o=>o.name,Wo);if(i){let o=wi(t,k.getCompare());return new v(s,L(e),new Ot({".priority":o},{".priority":k}))}else return new v(s,L(e),Ot.Default)}else{let t=v.EMPTY_NODE;return x(n,(i,r)=>{if(ee(n,i)&&i.substring(0,1)!=="."){let s=L(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(L(e))}}Mm(L);var yn=class extends Pt{constructor(e){super(),this.indexPath_=e,_(!I(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?ct(e.name,t.name):s}makePost(e,t){let i=L(e),r=v.EMPTY_NODE.updateChild(this.indexPath_,i);return new E(t,r)}maxPost(){let e=v.EMPTY_NODE.updateChild(this.indexPath_,Pn);return new E(Fe,e)}toString(){return vn(this.indexPath_,0).join("/")}};var Qs=class extends Pt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?ct(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return E.MIN}maxPost(){return E.MAX}makePost(e,t){let i=L(e);return new E(t,i)}toString(){return".value"}},mu=new Qs;function gu(n){return{type:"value",snapshotNode:n}}function Dt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function In(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function En(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Wm(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var wn=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){_(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(In(t,a)):_(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Dt(t,i)):o.trackChildChange(En(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(k,(r,s)=>{t.hasChild(r)||i.trackChildChange(In(r,s))}),t.isLeafNode()||t.forEachChild(k,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(En(r,s,o))}else i.trackChildChange(Dt(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?v.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Ti=class n{constructor(e){this.indexedFilter_=new wn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new E(t,i))||(i=v.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=v.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(v.EMPTY_NODE);let s=this;return t.forEachChild(k,(o,a)=>{s.matches(new E(o,a))||(r=r.updateImmediateChild(o,v.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Xs=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Ti(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new E(t,i))||(i=v.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=v.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=v.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(v.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,v.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,p)=>h(p,d)}else o=this.index_.getCompare();let a=e;_(a.numChildren()===this.limit_,"");let c=new E(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){let h=a.getImmediateChild(t),d=r.getChildAfterChild(this.index_,l,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);let p=d==null?1:o(d,c);if(u&&!i.isEmpty()&&p>=0)return s?.trackChildChange(En(t,i,h)),a.updateImmediateChild(t,i);{s?.trackChildChange(In(t,h));let w=a.updateImmediateChild(t,v.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(s?.trackChildChange(Dt(d.name,d.node)),w.updateImmediateChild(d.name,d.node)):w}}else return i.isEmpty()?e:u&&o(l,c)>=0?(s!=null&&(s.trackChildChange(In(l.name,l.node)),s.trackChildChange(Dt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,v.EMPTY_NODE)):e}};var Zs=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=k}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:it}hasEnd(){return this.endSet_}getIndexEndValue(){return _(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Fe}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===k}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Vm(n){return n.loadsAllData()?new wn(n.getIndex()):n.hasLimit()?new Xs(n):new Ti(n)}function Bm(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function $m(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Hm(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function jm(n,e){let t=n.copy();return t.index_=e,t}function kl(n){let e={};if(n.isDefault())return e;let t;if(n.index_===k?t="$priority":n.index_===mu?t="$value":n.index_===nt?t="$key":(_(n.index_ instanceof yn,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=N(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=N(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+N(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=N(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+N(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Rl(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==k&&(e.i=n.index_.toString()),e}var eo=class n extends vi{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(_(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Rn("p:rest:"),this.listens_={}}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=kl(e._queryParams);this.restRequest_(s+".json",c,(l,u)=>{let h=u;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(s,h,!1,i),$e(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",r(d,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=kl(e._queryParams),i=e._path.toString(),r=new q;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+He(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=mt(a.responseText)}catch{V("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&V("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var to=class{constructor(){this.rootNode_=v.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Ci(){return{value:null,children:new Map}}function vu(n,e,t){if(I(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=y(e);n.children.has(i)||n.children.set(i,Ci());let r=n.children.get(i);e=S(e),vu(r,e,t)}}function no(n,e,t){n.value!==null?t(e,n.value):zm(n,(i,r)=>{let s=new C(e.toString()+"/"+i);no(r,s,t)})}function zm(n,e){n.children.forEach((t,i)=>{e(i,t)})}var io=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&x(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var Pl=10*1e3,qm=30*1e3,Gm=300*1e3,ro=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new io(e);let i=Pl+(qm-Pl)*Math.random();fn(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;x(e,(r,s)=>{s>0&&ee(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),fn(this.reportStats_.bind(this),Math.floor(Math.random()*2*Gm))}};var fe=(function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n})(fe||{});function Vo(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Bo(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function $o(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var so=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=fe.ACK_USER_WRITE,this.source=Vo()}operationForChild(e){if(I(this.path)){if(this.affectedTree.value!=null)return _(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new C(e));return new n(T(),t,this.revert)}}else return _(y(this.path)===e,"operationForChild called for unrelated child."),new n(S(this.path),this.affectedTree,this.revert)}};var bi=class n{constructor(e,t){this.source=e,this.path=t,this.type=fe.LISTEN_COMPLETE}operationForChild(e){return I(this.path)?new n(this.source,T()):new n(this.source,S(this.path))}};var Lt=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=fe.OVERWRITE}operationForChild(e){return I(this.path)?new n(this.source,T(),this.snap.getImmediateChild(e)):new n(this.source,S(this.path),this.snap)}};var Tn=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=fe.MERGE}operationForChild(e){if(I(this.path)){let t=this.children.subtree(new C(e));return t.isEmpty()?null:t.value?new Lt(this.source,T(),t.value):new n(this.source,T(),t)}else return _(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,S(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var pe=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(I(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var oo=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Km(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Wm(o.childName,o.snapshotNode))}),hn(n,r,"child_removed",e,i,t),hn(n,r,"child_added",e,i,t),hn(n,r,"child_moved",s,i,t),hn(n,r,"child_changed",e,i,t),hn(n,r,"value",e,i,t),r}function hn(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,c)=>Jm(n,a,c)),o.forEach(a=>{let c=Ym(n,a,s);r.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function Ym(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Jm(n,e,t){if(e.childName==null||t.childName==null)throw Be("Should only compare child_ events.");let i=new E(e.childName,e.snapshotNode),r=new E(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function Wi(n,e){return{eventCache:n,serverCache:e}}function _n(n,e,t,i){return Wi(new pe(e,t,i),n.serverCache)}function yu(n,e,t,i){return Wi(n.eventCache,new pe(e,t,i))}function Si(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function rt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Rs,Qm=()=>(Rs||(Rs=new K(K_)),Rs),B=class n{static fromObject(e){let t=new n(null);return x(e,(i,r)=>{t=t.set(new C(i),r)}),t}constructor(e,t=Qm()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:T(),value:this.value};if(I(e))return null;{let i=y(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(S(e),t);return s!=null?{path:P(new C(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(I(e))return this;{let t=y(e),i=this.children.get(t);return i!==null?i.subtree(S(e)):new n(null)}}set(e,t){if(I(e))return new n(t,this.children);{let i=y(e),s=(this.children.get(i)||new n(null)).set(S(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(I(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),i=this.children.get(t);if(i){let r=i.remove(S(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(I(e))return this.value;{let t=y(e),i=this.children.get(t);return i?i.get(S(e)):null}}setTree(e,t){if(I(e))return t;{let i=y(e),s=(this.children.get(i)||new n(null)).setTree(S(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(T(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(P(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,T(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(I(e))return null;{let s=y(e),o=this.children.get(s);return o?o.findOnPath_(S(e),P(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,T(),t)}foreachOnPath_(e,t,i){if(I(e))return this;{this.value&&i(t,this.value);let r=y(e),s=this.children.get(r);return s?s.foreachOnPath_(S(e),P(t,r),i):new n(null)}}foreach(e){this.foreach_(T(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(P(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var re=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new B(null))}};function mn(n,e,t){if(I(e))return new re(new B(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=W(r,e);return s=s.updateChild(o,t),new re(n.writeTree_.set(r,s))}else{let r=new B(t),s=n.writeTree_.setTree(e,r);return new re(s)}}}function ao(n,e,t){let i=n;return x(t,(r,s)=>{i=mn(i,P(e,r),s)}),i}function Nl(n,e){if(I(e))return re.empty();{let t=n.writeTree_.setTree(e,new B(null));return new re(t)}}function co(n,e){return lt(n,e)!=null}function lt(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(W(t.path,e)):null}function Ol(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(k,(i,r)=>{e.push(new E(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new E(i,r.value))}),e}function Me(n,e){if(I(e))return n;{let t=lt(n,e);return t!=null?new re(new B(t)):new re(n.writeTree_.subtree(e))}}function lo(n){return n.writeTree_.isEmpty()}function Mt(n,e){return Iu(T(),n.writeTree_,e)}function Iu(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(_(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=Iu(P(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(P(n,".priority"),i)),t}}function Vi(n,e){return Cu(e,n)}function Xm(n,e,t,i,r){_(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=mn(n.visibleWrites,e,t)),n.lastWriteId=i}function Zm(n,e,t,i){_(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=ao(n.visibleWrites,e,t),n.lastWriteId=i}function eg(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function tg(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);_(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&ng(a,i.path)?r=!1:G(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return ig(n),!0;if(i.snap)n.visibleWrites=Nl(n.visibleWrites,i.path);else{let a=i.children;x(a,c=>{n.visibleWrites=Nl(n.visibleWrites,P(i.path,c))})}return!0}else return!1}function ng(n,e){if(n.snap)return G(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&G(P(n.path,t),e))return!0;return!1}function ig(n){n.visibleWrites=Eu(n.allWrites,rg,T()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function rg(n){return n.visible}function Eu(n,e,t){let i=re.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)G(t,o)?(a=W(t,o),i=mn(i,a,s.snap)):G(o,t)&&(a=W(o,t),i=mn(i,T(),s.snap.getChild(a)));else if(s.children){if(G(t,o))a=W(t,o),i=ao(i,a,s.children);else if(G(o,t))if(a=W(o,t),I(a))i=ao(i,T(),s.children);else{let c=$e(s.children,y(a));if(c){let l=c.getChild(S(a));i=mn(i,T(),l)}}}else throw Be("WriteRecord should have .snap or .children")}}return i}function wu(n,e,t,i,r){if(!i&&!r){let s=lt(n.visibleWrites,e);if(s!=null)return s;{let o=Me(n.visibleWrites,e);if(lo(o))return t;if(t==null&&!co(o,T()))return null;{let a=t||v.EMPTY_NODE;return Mt(o,a)}}}else{let s=Me(n.visibleWrites,e);if(!r&&lo(s))return t;if(!r&&t==null&&!co(s,T()))return null;{let o=function(l){return(l.visible||r)&&(!i||!~i.indexOf(l.writeId))&&(G(l.path,e)||G(e,l.path))},a=Eu(n.allWrites,o,e),c=t||v.EMPTY_NODE;return Mt(a,c)}}}function sg(n,e,t){let i=v.EMPTY_NODE,r=lt(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(k,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=Me(n.visibleWrites,e);return t.forEachChild(k,(o,a)=>{let c=Mt(Me(s,new C(o)),a);i=i.updateImmediateChild(o,c)}),Ol(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=Me(n.visibleWrites,e);return Ol(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function og(n,e,t,i,r){_(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=P(e,t);if(co(n.visibleWrites,s))return null;{let o=Me(n.visibleWrites,s);return lo(o)?r.getChild(t):Mt(o,r.getChild(t))}}function ag(n,e,t,i){let r=P(e,t),s=lt(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=Me(n.visibleWrites,r);return Mt(o,i.getNode().getImmediateChild(t))}else return null}function cg(n,e){return lt(n.visibleWrites,e)}function lg(n,e,t,i,r,s,o){let a,c=Me(n.visibleWrites,e),l=lt(c,T());if(l!=null)a=l;else if(t!=null)a=Mt(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=d.getNext();for(;p&&u.length<r;)h(p,i)!==0&&u.push(p),p=d.getNext();return u}else return[]}function ug(){return{visibleWrites:re.empty(),allWrites:[],lastWriteId:-1}}function Ai(n,e,t,i){return wu(n.writeTree,n.treePath,e,t,i)}function Ho(n,e){return sg(n.writeTree,n.treePath,e)}function Dl(n,e,t,i){return og(n.writeTree,n.treePath,e,t,i)}function ki(n,e){return cg(n.writeTree,P(n.treePath,e))}function dg(n,e,t,i,r,s){return lg(n.writeTree,n.treePath,e,t,i,r,s)}function jo(n,e,t){return ag(n.writeTree,n.treePath,e,t)}function Tu(n,e){return Cu(P(n.treePath,e),n.writeTree)}function Cu(n,e){return{treePath:n,writeTree:e}}var uo=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;_(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),_(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,En(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,In(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,Dt(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,En(i,e.snapshotNode,r.oldSnap));else throw Be("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var ho=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},bu=new ho,Cn=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new pe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return jo(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:rt(this.viewCache_),s=dg(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function hg(n){return{filter:n}}function fg(n,e){_(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),_(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function pg(n,e,t,i,r){let s=new uo,o,a;if(t.type===fe.OVERWRITE){let l=t;l.source.fromUser?o=fo(n,e,l.path,l.snap,i,r,s):(_(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!I(l.path),o=Ri(n,e,l.path,l.snap,i,r,a,s))}else if(t.type===fe.MERGE){let l=t;l.source.fromUser?o=mg(n,e,l.path,l.children,i,r,s):(_(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=po(n,e,l.path,l.children,i,r,a,s))}else if(t.type===fe.ACK_USER_WRITE){let l=t;l.revert?o=yg(n,e,l.path,i,r,s):o=gg(n,e,l.path,l.affectedTree,i,r,s)}else if(t.type===fe.LISTEN_COMPLETE)o=vg(n,e,t.path,i,s);else throw Be("Unknown operation type: "+t.type);let c=s.getChanges();return _g(e,o,c),{viewCache:o,changes:c}}function _g(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Si(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(gu(Si(e)))}}function Su(n,e,t,i,r,s){let o=e.eventCache;if(ki(i,t)!=null)return e;{let a,c;if(I(t))if(_(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=rt(e),u=l instanceof v?l:v.EMPTY_NODE,h=Ho(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{let l=Ai(i,rt(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{let l=y(t);if(l===".priority"){_(Ue(t)===1,"Can't have a priority with additional path components");let u=o.getNode();c=e.serverCache.getNode();let h=Dl(i,t,u,c);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{let u=S(t),h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();let d=Dl(i,t,o.getNode(),c);d!=null?h=o.getNode().getImmediateChild(l).updateChild(u,d):h=o.getNode().getImmediateChild(l)}else h=jo(i,l,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),l,h,u,r,s):a=o.getNode()}}return _n(e,a,o.isFullyInitialized()||I(t),n.filter.filtersNodes())}}function Ri(n,e,t,i,r,s,o,a){let c=e.serverCache,l,u=o?n.filter:n.filter.getIndexedFilter();if(I(t))l=u.updateFullNode(c.getNode(),i,null);else if(u.filtersNodes()&&!c.isFiltered()){let p=c.getNode().updateChild(t,i);l=u.updateFullNode(c.getNode(),p,null)}else{let p=y(t);if(!c.isCompleteForPath(t)&&Ue(t)>1)return e;let m=S(t),A=c.getNode().getImmediateChild(p).updateChild(m,i);p===".priority"?l=u.updatePriority(c.getNode(),A):l=u.updateChild(c.getNode(),p,A,m,bu,null)}let h=yu(e,l,c.isFullyInitialized()||I(t),u.filtersNodes()),d=new Cn(r,h,s);return Su(n,h,t,r,d,a)}function fo(n,e,t,i,r,s,o){let a=e.eventCache,c,l,u=new Cn(r,e,s);if(I(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=_n(e,l,!0,n.filter.filtersNodes());else{let h=y(t);if(h===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=_n(e,l,a.isFullyInitialized(),a.isFiltered());else{let d=S(t),p=a.getNode().getImmediateChild(h),m;if(I(d))m=i;else{let w=u.getCompleteChild(h);w!=null?xo(d)===".priority"&&w.getChild(uu(d)).isEmpty()?m=w:m=w.updateChild(d,i):m=v.EMPTY_NODE}if(p.equals(m))c=e;else{let w=n.filter.updateChild(a.getNode(),h,m,d,u,o);c=_n(e,w,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Ll(n,e){return n.eventCache.isCompleteForChild(e)}function mg(n,e,t,i,r,s,o){let a=e;return i.foreach((c,l)=>{let u=P(t,c);Ll(e,y(u))&&(a=fo(n,a,u,l,r,s,o))}),i.foreach((c,l)=>{let u=P(t,c);Ll(e,y(u))||(a=fo(n,a,u,l,r,s,o))}),a}function Ml(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function po(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;I(t)?l=i:l=new B(null).setTree(t,i);let u=e.serverCache.getNode();return l.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let p=e.serverCache.getNode().getImmediateChild(h),m=Ml(n,p,d);c=Ri(n,c,new C(h),m,r,s,o,a)}}),l.children.inorderTraversal((h,d)=>{let p=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!p){let m=e.serverCache.getNode().getImmediateChild(h),w=Ml(n,m,d);c=Ri(n,c,new C(h),w,r,s,o,a)}}),c}function gg(n,e,t,i,r,s,o){if(ki(r,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(I(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Ri(n,e,t,c.getNode().getChild(t),r,s,a,o);if(I(t)){let l=new B(null);return c.getNode().forEachChild(nt,(u,h)=>{l=l.set(new C(u),h)}),po(n,e,t,l,r,s,a,o)}else return e}else{let l=new B(null);return i.foreach((u,h)=>{let d=P(t,u);c.isCompleteForPath(d)&&(l=l.set(u,c.getNode().getChild(d)))}),po(n,e,t,l,r,s,a,o)}}function vg(n,e,t,i,r){let s=e.serverCache,o=yu(e,s.getNode(),s.isFullyInitialized()||I(t),s.isFiltered());return Su(n,o,t,i,bu,r)}function yg(n,e,t,i,r,s){let o;if(ki(i,t)!=null)return e;{let a=new Cn(i,e,r),c=e.eventCache.getNode(),l;if(I(t)||y(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Ai(i,rt(e));else{let h=e.serverCache.getNode();_(h instanceof v,"serverChildren would be complete if leaf node"),u=Ho(i,h)}u=u,l=n.filter.updateFullNode(c,u,s)}else{let u=y(t),h=jo(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?l=n.filter.updateChild(c,u,h,S(t),a,s):e.eventCache.getNode().hasChild(u)?l=n.filter.updateChild(c,u,v.EMPTY_NODE,S(t),a,s):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ai(i,rt(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||ki(i,T())!=null,_n(e,l,o,n.filter.filtersNodes())}}var _o=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new wn(i.getIndex()),s=Vm(i);this.processor_=hg(s);let o=t.serverCache,a=t.eventCache,c=r.updateFullNode(v.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(v.EMPTY_NODE,a.getNode(),null),u=new pe(c,o.isFullyInitialized(),r.filtersNodes()),h=new pe(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Wi(h,u),this.eventGenerator_=new oo(this.query_)}get query(){return this.query_}};function Ig(n){return n.viewCache_.serverCache.getNode()}function Eg(n){return Si(n.viewCache_)}function wg(n,e){let t=rt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!I(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function xl(n){return n.eventRegistrations_.length===0}function Tg(n,e){n.eventRegistrations_.push(e)}function Fl(n,e,t){let i=[];if(t){_(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function Ul(n,e,t,i){e.type===fe.MERGE&&e.source.queryId!==null&&(_(rt(n.viewCache_),"We should always have a full cache before handling merges"),_(Si(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=pg(n.processor_,r,e,t,i);return fg(n.processor_,s.viewCache),_(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Au(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Cg(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(k,(s,o)=>{i.push(Dt(s,o))}),t.isFullyInitialized()&&i.push(gu(t.getNode())),Au(n,i,t.getNode(),e)}function Au(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return Km(n.eventGenerator_,e,t,r)}var Pi,Ni=class{constructor(){this.views=new Map}};function bg(n){_(!Pi,"__referenceConstructor has already been defined"),Pi=n}function Sg(){return _(Pi,"Reference.ts has not been loaded"),Pi}function Ag(n){return n.views.size===0}function zo(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return _(s!=null,"SyncTree gave us an op for an invalid query."),Ul(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(Ul(o,e,t,i));return s}}function ku(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Ai(t,r?i:null),c=!1;a?c=!0:i instanceof v?(a=Ho(t,i),c=!1):(a=v.EMPTY_NODE,c=!1);let l=Wi(new pe(a,c,!1),new pe(i,r,!1));return new _o(e,l)}return o}function kg(n,e,t,i,r,s){let o=ku(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Tg(o,t),Cg(o,t)}function Rg(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=We(n);if(r==="default")for(let[c,l]of n.views.entries())o=o.concat(Fl(l,t,i)),xl(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{let c=n.views.get(r);c&&(o=o.concat(Fl(c,t,i)),xl(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!We(n)&&s.push(new(Sg())(e._repo,e._path)),{removed:s,events:o}}function Ru(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function xe(n,e){let t=null;for(let i of n.views.values())t=t||wg(i,e);return t}function Pu(n,e){if(e._queryParams.loadsAllData())return Bi(n);{let i=e._queryIdentifier;return n.views.get(i)}}function Nu(n,e){return Pu(n,e)!=null}function We(n){return Bi(n)!=null}function Bi(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Oi;function Pg(n){_(!Oi,"__referenceConstructor has already been defined"),Oi=n}function Ng(){return _(Oi,"Reference.ts has not been loaded"),Oi}var Og=1,Di=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new B(null),this.pendingWriteTree_=ug(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Ou(n,e,t,i,r){return Xm(n.pendingWriteTree_,e,t,i,r),r?Ut(n,new Lt(Vo(),e,t)):[]}function Dg(n,e,t,i){Zm(n.pendingWriteTree_,e,t,i);let r=B.fromObject(t);return Ut(n,new Tn(Vo(),e,r))}function Le(n,e,t=!1){let i=eg(n.pendingWriteTree_,e);if(tg(n.pendingWriteTree_,e)){let s=new B(null);return i.snap!=null?s=s.set(T(),!0):x(i.children,o=>{s=s.set(new C(o),!0)}),Ut(n,new so(i.path,s,t))}else return[]}function Nn(n,e,t){return Ut(n,new Lt(Bo(),e,t))}function Lg(n,e,t){let i=B.fromObject(t);return Ut(n,new Tn(Bo(),e,i))}function Mg(n,e){return Ut(n,new bi(Bo(),e))}function xg(n,e,t){let i=Go(n,t);if(i){let r=Ko(i),s=r.path,o=r.queryId,a=W(s,e),c=new bi($o(o),a);return Yo(n,s,c)}else return[]}function Li(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||Nu(o,e))){let c=Rg(o,e,t,i);Ag(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let l=c.removed;if(a=c.events,!r){let u=l.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(s,(d,p)=>We(p));if(u&&!h){let d=n.syncPointTree_.subtree(s);if(!d.isEmpty()){let p=Wg(d);for(let m=0;m<p.length;++m){let w=p[m],A=w.query,H=xu(n,w);n.listenProvider_.startListening(gn(A),bn(n,A),H.hashFn,H.onComplete)}}}!h&&l.length>0&&!i&&(u?n.listenProvider_.stopListening(gn(e),null):l.forEach(d=>{let p=n.queryToTagMap.get($i(d));n.listenProvider_.stopListening(gn(d),p)}))}Vg(n,l)}return a}function Du(n,e,t,i){let r=Go(n,i);if(r!=null){let s=Ko(r),o=s.path,a=s.queryId,c=W(o,e),l=new Lt($o(a),c,t);return Yo(n,o,l)}else return[]}function Fg(n,e,t,i){let r=Go(n,i);if(r){let s=Ko(r),o=s.path,a=s.queryId,c=W(o,e),l=B.fromObject(t),u=new Tn($o(a),c,l);return Yo(n,o,u)}else return[]}function mo(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(d,p)=>{let m=W(d,r);s=s||xe(p,m),o=o||We(p)});let a=n.syncPointTree_.get(r);a?(o=o||We(a),s=s||xe(a,T())):(a=new Ni,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=v.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((p,m)=>{let w=xe(m,T());w&&(s=s.updateImmediateChild(p,w))}));let l=Nu(a,e);if(!l&&!e._queryParams.loadsAllData()){let d=$i(e);_(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let p=Bg();n.queryToTagMap.set(d,p),n.tagToQueryMap.set(p,d)}let u=Vi(n.pendingWriteTree_,r),h=kg(a,e,t,u,s,c);if(!l&&!o&&!i){let d=Pu(a,e);h=h.concat($g(n,e,d))}return h}function qo(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=W(o,e),l=xe(a,c);if(l)return l});return wu(r,e,s,t,!0)}function Ug(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(l,u)=>{let h=W(l,t);i=i||xe(u,h)});let r=n.syncPointTree_.get(t);r?i=i||xe(r,T()):(r=new Ni,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new pe(i,!0,!1):null,a=Vi(n.pendingWriteTree_,e._path),c=ku(r,e,a,s?o.getNode():v.EMPTY_NODE,s);return Eg(c)}function Ut(n,e){return Lu(e,n.syncPointTree_,null,Vi(n.pendingWriteTree_,T()))}function Lu(n,e,t,i){if(I(n.path))return Mu(n,e,t,i);{let r=e.get(T());t==null&&r!=null&&(t=xe(r,T()));let s=[],o=y(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let l=t?t.getImmediateChild(o):null,u=Tu(i,o);s=s.concat(Lu(a,c,l,u))}return r&&(s=s.concat(zo(r,n,i,t))),s}}function Mu(n,e,t,i){let r=e.get(T());t==null&&r!=null&&(t=xe(r,T()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,l=Tu(i,o),u=n.operationForChild(o);u&&(s=s.concat(Mu(u,a,c,l)))}),r&&(s=s.concat(zo(r,n,i,t))),s}function xu(n,e){let t=e.query,i=bn(n,t);return{hashFn:()=>(Ig(e)||v.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?xg(n,t._path,i):Mg(n,t._path);{let s=Q_(r,t);return Li(n,t,null,s)}}}}function bn(n,e){let t=$i(e);return n.queryToTagMap.get(t)}function $i(n){return n._path.toString()+"$"+n._queryIdentifier}function Go(n,e){return n.tagToQueryMap.get(e)}function Ko(n){let e=n.indexOf("$");return _(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new C(n.substr(0,e))}}function Yo(n,e,t){let i=n.syncPointTree_.get(e);_(i,"Missing sync point for query tag that we're tracking");let r=Vi(n.pendingWriteTree_,e);return zo(i,t,r,null)}function Wg(n){return n.fold((e,t,i)=>{if(t&&We(t))return[Bi(t)];{let r=[];return t&&(r=Ru(t)),x(i,(s,o)=>{r=r.concat(o)}),r}})}function gn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ng())(n._repo,n._path):n}function Vg(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=$i(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function Bg(){return Og++}function $g(n,e,t){let i=e._path,r=bn(n,e),s=xu(n,t),o=n.listenProvider_.startListening(gn(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)_(!We(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((l,u,h)=>{if(!I(l)&&u&&We(u))return[Bi(u).query];{let d=[];return u&&(d=d.concat(Ru(u).map(p=>p.query))),x(h,(p,m)=>{d=d.concat(m)}),d}});for(let l=0;l<c.length;++l){let u=c[l];n.listenProvider_.stopListening(gn(u),bn(n,u))}}return o}var go=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},vo=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=P(this.path_,e);return new n(this.syncTree_,t)}node(){return qo(this.syncTree_,this.path_)}},Hg=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Wl=function(n,e,t){if(!n||typeof n!="object")return n;if(_(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return jg(n[".sv"],e,t);if(typeof n[".sv"]=="object")return zg(n[".sv"],e);_(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},jg=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:_(!1,"Unexpected server value: "+n)}},zg=function(n,e,t){n.hasOwnProperty("increment")||_(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&_(!1,"Unexpected increment value: "+i);let r=e.node();if(_(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},Fu=function(n,e,t,i){return Jo(e,new vo(t,n),i)},Uu=function(n,e,t){return Jo(n,new go(e),t)};function Jo(n,e,t){let i=n.getPriority().val(),r=Wl(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=Wl(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Nt(a,L(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new Nt(r))),o.forEachChild(k,(a,c)=>{let l=Jo(c,e.getImmediateChild(a),t);l!==c&&(s=s.updateImmediateChild(a,l))}),s}}var Sn=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Qo(n,e){let t=e instanceof C?e:new C(e),i=n,r=y(t);for(;r!==null;){let s=$e(i.node.children,r)||{children:{},childCount:0};i=new Sn(r,i,s),t=S(t),r=y(t)}return i}function Wt(n){return n.node.value}function Wu(n,e){n.node.value=e,yo(n)}function Vu(n){return n.node.childCount>0}function qg(n){return Wt(n)===void 0&&!Vu(n)}function Hi(n,e){x(n.node.children,(t,i)=>{e(new Sn(t,n,i))})}function Bu(n,e,t,i){t&&!i&&e(n),Hi(n,r=>{Bu(r,e,!0,i)}),t&&i&&e(n)}function Gg(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function On(n){return new C(n.parent===null?n.name:On(n.parent)+"/"+n.name)}function yo(n){n.parent!==null&&Kg(n.parent,n.name,n)}function Kg(n,e,t){let i=qg(t),r=ee(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,yo(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,yo(n))}var Yg=/[\[\].#$\/\u0000-\u001F\u007F]/,Jg=/[\[\].#$\u0000-\u001F\u007F]/,Ps=10*1024*1024,ji=function(n){return typeof n=="string"&&n.length!==0&&!Yg.test(n)},$u=function(n){return typeof n=="string"&&n.length!==0&&!Jg.test(n)},Qg=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),$u(n)},Io=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Do(n)||n&&typeof n=="object"&&ee(n,".sv")},Dn=function(n,e,t,i){i&&e===void 0||zi(It(n,"value"),e,t)},zi=function(n,e,t){let i=t instanceof C?new js(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Ze(i));if(typeof e=="function")throw new Error(n+"contains a function "+Ze(i)+" with contents = "+e.toString());if(Do(e))throw new Error(n+"contains "+e.toString()+" "+Ze(i));if(typeof e=="string"&&e.length>Ps/3&&zt(e)>Ps)throw new Error(n+"contains a string greater than "+Ps+" utf8 bytes "+Ze(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(x(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!ji(o)))throw new Error(n+" contains an invalid key ("+o+") "+Ze(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Am(i,o),zi(n,a,i),km(i)}),r&&s)throw new Error(n+' contains ".value" child '+Ze(i)+" in addition to actual children.")}},Xg=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=vn(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!ji(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Sm);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&G(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},Zg=function(n,e,t,i){if(i&&e===void 0)return;let r=It(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];x(e,(o,a)=>{let c=new C(o);if(zi(r,a,P(t,c)),xo(c)===".priority"&&!Io(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),Xg(r,s)};var ev=function(n,e,t,i){if(!(i&&t===void 0)&&!ji(t))throw new Error(It(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Xo=function(n,e,t,i){if(!(i&&t===void 0)&&!$u(t))throw new Error(It(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},tv=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Xo(n,e,t,i)},Zo=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},nv=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ji(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Qg(t))throw new Error(It(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Eo=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function qi(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!Fo(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function Hu(n,e,t){qi(n,t),ju(n,i=>Fo(i,e))}function Y(n,e,t){qi(n,t),ju(n,i=>G(i,e)||G(e,i))}function ju(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(iv(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function iv(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();tt&&M("event: "+t.toString()),Ft(i)}}}var rv="repo_interrupt",sv=25,wo=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Eo,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ci(),this.transactionQueueTree_=new Sn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function ov(n,e,t){if(n.stats_=Mo(n.repoInfo_),n.forceRestClient_||tm())n.server_=new eo(n.repoInfo_,(i,r,s,o)=>{Vl(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Bl(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{N(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Uo(n.repoInfo_,e,(i,r,s,o)=>{Vl(n,i,r,s,o)},i=>{Bl(n,i)},i=>{av(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=im(n.repoInfo_,()=>new ro(n.stats_,n.server_)),n.infoData_=new to,n.infoSyncTree_=new Di({startListening:(i,r,s,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=Nn(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ea(n,"connected",!1),n.serverSyncTree_=new Di({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{let l=o(a,c);Y(n.eventQueue_,i._path,l)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function zu(n){let t=n.infoData_.getNode(new C(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Gi(n){return Hg({timestamp:zu(n)})}function Vl(n,e,t,i,r){n.dataUpdateCount++;let s=new C(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let c=jt(t,l=>L(l));o=Fg(n.serverSyncTree_,s,c,r)}else{let c=L(t);o=Du(n.serverSyncTree_,s,c,r)}else if(i){let c=jt(t,l=>L(l));o=Lg(n.serverSyncTree_,s,c)}else{let c=L(t);o=Nn(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=xt(n,s)),Y(n.eventQueue_,a,o)}function Bl(n,e){ea(n,"connected",e),e===!1&&dv(n)}function av(n,e){x(e,(t,i)=>{ea(n,t,i)})}function ea(n,e,t){let i=new C("/.info/"+e),r=L(t);n.infoData_.updateSnapshot(i,r);let s=Nn(n.infoSyncTree_,i,r);Y(n.eventQueue_,i,s)}function ta(n){return n.nextWriteId_++}function cv(n,e,t){let i=Ug(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=L(r).withIndex(e._queryParams.getIndex());mo(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Nn(n.serverSyncTree_,e._path,s);else{let a=bn(n.serverSyncTree_,e);o=Du(n.serverSyncTree_,e._path,s,a)}return Y(n.eventQueue_,e._path,o),Li(n.serverSyncTree_,e,t,null,!0),s},r=>(Ln(n,"get for query "+N(e)+" failed: "+r),Promise.reject(new Error(r))))}function lv(n,e,t,i,r){Ln(n,"set",{path:e.toString(),value:t,priority:i});let s=Gi(n),o=L(t,i),a=qo(n.serverSyncTree_,e),c=Uu(o,a,s),l=ta(n),u=Ou(n.serverSyncTree_,e,c,l,!0);qi(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,p)=>{let m=d==="ok";m||V("set at "+e+" failed: "+d);let w=Le(n.serverSyncTree_,l,!m);Y(n.eventQueue_,e,w),To(n,r,d,p)});let h=ia(n,e);xt(n,h),Y(n.eventQueue_,h,[])}function uv(n,e,t,i){Ln(n,"update",{path:e.toString(),value:t});let r=!0,s=Gi(n),o={};if(x(t,(a,c)=>{r=!1,o[a]=Fu(P(e,a),L(c),n.serverSyncTree_,s)}),r)M("update() called with empty data.  Don't do anything."),To(n,i,"ok",void 0);else{let a=ta(n),c=Dg(n.serverSyncTree_,e,o,a);qi(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,u)=>{let h=l==="ok";h||V("update at "+e+" failed: "+l);let d=Le(n.serverSyncTree_,a,!h),p=d.length>0?xt(n,e):e;Y(n.eventQueue_,p,d),To(n,i,l,u)}),x(t,l=>{let u=ia(n,P(e,l));xt(n,u)}),Y(n.eventQueue_,e,[])}}function dv(n){Ln(n,"onDisconnectEvents");let e=Gi(n),t=Ci();no(n.onDisconnect_,T(),(r,s)=>{let o=Fu(r,s,n.serverSyncTree_,e);vu(t,r,o)});let i=[];no(t,T(),(r,s)=>{i=i.concat(Nn(n.serverSyncTree_,r,s));let o=ia(n,r);xt(n,o)}),n.onDisconnect_=Ci(),Y(n.eventQueue_,T(),i)}function hv(n,e,t){let i;y(e._path)===".info"?i=mo(n.infoSyncTree_,e,t):i=mo(n.serverSyncTree_,e,t),Hu(n.eventQueue_,e._path,i)}function $l(n,e,t){let i;y(e._path)===".info"?i=Li(n.infoSyncTree_,e,t):i=Li(n.serverSyncTree_,e,t),Hu(n.eventQueue_,e._path,i)}function fv(n){n.persistentConnection_&&n.persistentConnection_.interrupt(rv)}function Ln(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),M(t,...e)}function To(n,e,t,i){e&&Ft(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function qu(n,e,t){return qo(n.serverSyncTree_,e,t)||v.EMPTY_NODE}function na(n,e=n.transactionQueueTree_){if(e||Ki(n,e),Wt(e)){let t=Ku(n,e);_(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&pv(n,On(e),t)}else Vu(e)&&Hi(e,t=>{na(n,t)})}function pv(n,e,t){let i=t.map(l=>l.currentWriteId),r=qu(n,e,i),s=r,o=r.hash();for(let l=0;l<t.length;l++){let u=t[l];_(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=W(e,u.path);s=s.updateChild(h,u.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,l=>{Ln(n,"transaction put response",{path:c.toString(),status:l});let u=[];if(l==="ok"){let h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(Le(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Ki(n,Qo(n.transactionQueueTree_,e)),na(n,n.transactionQueueTree_),Y(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Ft(h[d])}else{if(l==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{V("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=l}xt(n,e)}},o)}function xt(n,e){let t=Gu(n,e),i=On(t),r=Ku(n,t);return _v(n,r,i),i}function _v(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],l=W(t,c.path),u=!1,h;if(_(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,r=r.concat(Le(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=sv)u=!0,h="maxretry",r=r.concat(Le(n.serverSyncTree_,c.currentWriteId,!0));else{let d=qu(n,c.path,o);c.currentInputSnapshot=d;let p=e[a].update(d.val());if(p!==void 0){zi("transaction failed: Data returned ",p,c.path);let m=L(p);typeof p=="object"&&p!=null&&ee(p,".priority")||(m=m.updatePriority(d.getPriority()));let A=c.currentWriteId,H=Gi(n),j=Uu(m,d,H);c.currentOutputSnapshotRaw=m,c.currentOutputSnapshotResolved=j,c.currentWriteId=ta(n),o.splice(o.indexOf(A),1),r=r.concat(Ou(n.serverSyncTree_,c.path,j,c.currentWriteId,c.applyLocally)),r=r.concat(Le(n.serverSyncTree_,A,!0))}else u=!0,h="nodata",r=r.concat(Le(n.serverSyncTree_,c.currentWriteId,!0))}Y(n.eventQueue_,t,r),r=[],u&&(e[a].status=2,(function(d){setTimeout(d,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Ki(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Ft(i[a]);na(n,n.transactionQueueTree_)}function Gu(n,e){let t,i=n.transactionQueueTree_;for(t=y(e);t!==null&&Wt(i)===void 0;)i=Qo(i,t),e=S(e),t=y(e);return i}function Ku(n,e){let t=[];return Yu(n,e,t),t.sort((i,r)=>i.order-r.order),t}function Yu(n,e,t){let i=Wt(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);Hi(e,r=>{Yu(n,r,t)})}function Ki(n,e){let t=Wt(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,Wu(e,t.length>0?t:void 0)}Hi(e,i=>{Ki(n,i)})}function ia(n,e){let t=On(Gu(n,e)),i=Qo(n.transactionQueueTree_,e);return Gg(i,r=>{Ns(n,r)}),Ns(n,i),Bu(i,r=>{Ns(n,r)}),t}function Ns(n,e){let t=Wt(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(_(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(_(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Le(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Wu(e,void 0):t.length=s+1,Y(n.eventQueue_,On(e),r);for(let o=0;o<i.length;o++)Ft(i[o])}}function mv(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function gv(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):V(`Invalid query segment '${t}' in query '${n}'`)}return e}var Hl=function(n,e){let t=vv(n),i=t.namespace;t.domain==="firebase.com"&&we(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&we("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||q_();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new mi(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new C(t.pathString)}},vv=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(r=mv(n.substring(u,h)));let d=gv(n.substring(Math.min(n.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;let p=e.slice(0,l);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let m=e.indexOf(".");i=e.substring(0,m).toLowerCase(),t=e.substring(m+1),s=i}"ns"in d&&(s=d.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var jl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",yv=(function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=jl.charAt(t%64),t=Math.floor(t/64);_(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=jl.charAt(e[r]);return _(o.length===20,"nextPushId: Length should be 20."),o}})();var Mi=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+N(this.snapshot.exportVal())}},xi=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Fi=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return _(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var st=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return I(this._path)?null:xo(this._path)}get ref(){return new _e(this._repo,this._path)}get _queryIdentifier(){let e=Rl(this._queryParams),t=Lo(e);return t==="{}"?"default":t}get _queryObject(){return Rl(this._queryParams)}isEqual(e){if(e=O(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=Fo(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+bm(this._path)}};function Iv(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function ra(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===nt){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==it)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==Fe)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===k){if(e!=null&&!Io(e)||t!=null&&!Io(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(_(n.getIndex()instanceof yn||n.getIndex()===mu,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ju(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var _e=class n extends st{constructor(e,t){super(e,t,new Zs,!1)}get parent(){let e=uu(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},An=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new C(e),i=ot(this.ref,e);return new n(this._node.getChild(t),i,k)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,ot(this.ref,i),k)))}hasChild(e){let t=new C(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Qu(n,e){return n=O(n),n._checkNotDeleted("ref"),e!==void 0?ot(n._root,e):n._root}function ot(n,e){return n=O(n),y(n._path)===null?tv("child","path",e,!1):Xo("child","path",e,!1),new _e(n._repo,P(n._path,e))}function Xu(n,e){n=O(n),Zo("push",n._path),Dn("push",e,n._path,!0);let t=zu(n._repo),i=yv(t),r=ot(n,i),s=ot(n,i),o;return e!=null?o=Yi(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function Zu(n){return Zo("remove",n._path),Yi(n,null)}function Yi(n,e){n=O(n),Zo("set",n._path),Dn("set",e,n._path,!1);let t=new q;return lv(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function ed(n,e){Zg("update",e,n._path,!1);let t=new q;return uv(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function td(n){n=O(n);let e=new Fi(()=>{}),t=new Ui(e);return cv(n._repo,n,t).then(i=>new An(i,new _e(n._repo,n._path),n._queryParams.getIndex()))}var Ui=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Mi("value",this,new An(e.snapshotNode,new _e(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new xi(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Co=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new xi(this,e,t):null}createEvent(e,t){_(e.childName!=null,"Child events should have a childName.");let i=ot(new _e(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Mi(e.type,this,new An(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Ev(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let c=t,l=(u,h)=>{$l(n._repo,n,a),c(u,h)};l.userCallback=t.userCallback,l.context=t.context,t=l}let o=new Fi(t,s||void 0),a=e==="value"?new Ui(o):new Co(e,o);return hv(n._repo,n,a),()=>$l(n._repo,n,a)}function sa(n,e,t,i){return Ev(n,"value",e,t,i)}var at=class{},bo=class extends at{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Dn("endAt",this._value,e._path,!0);let t=Hm(e._queryParams,this._value,this._key);if(Ju(t),ra(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new st(e._repo,e._path,t,e._orderByCalled)}};var So=class extends at{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Dn("startAt",this._value,e._path,!0);let t=$m(e._queryParams,this._value,this._key);if(Ju(t),ra(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new st(e._repo,e._path,t,e._orderByCalled)}};var Ao=class extends at{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new st(e._repo,e._path,Bm(e._queryParams,this._limit),e._orderByCalled)}};function wv(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Ao(n)}var ko=class extends at{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Iv(e,"orderByChild");let t=new C(this._path);if(I(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new yn(t),r=jm(e._queryParams,i);return ra(r),new st(e._repo,e._path,r,!0)}};function nd(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Xo("orderByChild","path",n,!1),new ko(n)}var Ro=class extends at{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Dn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new bo(this._value,this._key)._apply(new So(this._value,this._key)._apply(e))}};function id(n,e){return ev("equalTo","key",e,!0),new Ro(n,e)}function rd(n,...e){let t=O(n);for(let i of e)t=i._apply(t);return t}bg(_e);Pg(_e);var Tv="FIREBASE_DATABASE_EMULATOR_HOST",Po={},Cv=!1;function bv(n,e,t,i){let r=e.lastIndexOf(":"),s=e.substring(0,r),o=Ce(s);n.repoInfo_=new mi(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function Sv(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||we("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),M("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Hl(s,r),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[Tv]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=Hl(s,r),a=o.repoInfo):c=!o.repoInfo.secure;let u=r&&c?new pn(pn.OWNER):new Fs(n.name,n.options,e);nv("Invalid Firebase Database URL",o),I(o.path)||we("Database URL must point to the root of a Firebase Database (not including a child path).");let h=kv(a,n,u,new xs(n,t));return new No(h,n)}function Av(n,e){let t=Po[e];(!t||t[n.key]!==n)&&we(`Database ${e}(${n.repoInfo_}) has already been deleted.`),fv(n),delete t[n.key]}function kv(n,e,t,i){let r=Po[e.name];r||(r={},Po[e.name]=r);let s=r[n.toURLString()];return s&&we("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new wo(n,Cv,t,i),r[n.toURLString()]=s,s}var No=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ov(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new _e(this._repo,T())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Av(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&we("Cannot call "+e+" on a deleted database.")}};function sd(n=ze(),e){let t=Et(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let i=Pa("database");i&&od(t,...i)}return t}function od(n,e,t,i={}){n=O(n),n._checkNotDeleted("useEmulator");let r=`${e}:${t}`,s=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&ce(i,s.repoInfo_.emulatorOptions))return;we("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&we('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new pn(pn.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:Na(i.mockUserToken,n.app.options.projectId);o=new pn(a)}Ce(e)&&(Vn(e),Bn("Database",!0)),bv(s,r,i,o)}function Rv(n){H_(Se),te(new U("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Sv(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),R(hl,fl,n),R(hl,fl,"esm2017")}var Pv={".sv":"timestamp"};function _E(){return Pv}Uo.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Uo.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Rv();var ut=class{constructor(e){return e}},ad="database",oa=class{constructor(){return Tt(ad)}};var aa=new ft("angularfire2.database-instances");function Nv(n,e){let t=Yt(ad,n,e);return t&&new ut(t)}function Ov(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new ut(i)}}var Dv={provide:oa,deps:[[new z,aa]]},Lv={provide:ut,useFactory:Nv,deps:[[new z,aa],ge]};function XE(n,...e){return R("angularfire",Ae.full,"rtdb"),pt([Lv,Dv,{provide:aa,useFactory:Ov(n),multi:!0,deps:[oe,Te,ke,Ge,[new z,an],[new z,Ct],...e]}])}var ZE=D(id,!0,2);var ew=D(td,!0),tw=D(sd,!0);var nw=D(nd,!0,2);var iw=D(Xu,!0,2),rw=D(rd,!0,2),ca=D(Qu,!0,2);var sw=D(Zu,!0,2);var cd=D(Yi,!0,2);var ow=D(ed,!0,2);var ld=class n{constructor(e,t){this.auth=e;this.db=t}register(e,t,i){return ht(cl(this.auth,e,t)).pipe(Mn(r=>{let s=r.user;return s?ht(dl(s,{displayName:i})).pipe(Mn(()=>ht(cd(ca(this.db,`users/${s.uid}`),{email:s.email,displayName:i,createdAt:new Date().toISOString()}))),_a(()=>{})):pa(()=>new Error("User creation failed."))}))}login(e,t){return ht(ll(this.auth,e,t))}logout(){return ht(ul(this.auth))}getCurrentUser(){return this.auth.currentUser}authState(){return new se(e=>({unsubscribe:this.auth.onAuthStateChanged(e)}))}isAdmin(){return this.authState().pipe(Mn(e=>e?new se(t=>{let i=ca(this.db,`roles/admin/${e.uid}`),r=sa(i,s=>t.next(!!s.val()),s=>t.error(s));return()=>r()}):fa(!1)))}static \u0275fac=function(t){return new(t||n)(ir(Xe),ir(ut))};static \u0275prov=xn({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Ty as a,Cy as b,Hy as c,jy as d,cE as e,lE as f,wv as g,nd as h,rd as i,_E as j,ut as k,XE as l,ZE as m,ew as n,tw as o,nw as p,iw as q,rw as r,ca as s,sw as t,cd as u,ow as v,ld as w};
