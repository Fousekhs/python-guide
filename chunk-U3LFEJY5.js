import{j as m,k as y,m as d,n as p,p as g,q as v,r as l,s as c,u as h,v as S}from"./chunk-ZCTLOLTJ.js";import{$ as I,da as q,o,u as a}from"./chunk-PT7SL42D.js";import{a as u,b}from"./chunk-WTI2L5DI.js";var R=class f{constructor(e){this.db=e}createQuestioningSession(e,s,t,n){let r=c(this.db,"questioning-sessions"),i=v(r),A=b(u(u({id:i.key,userId:e,sectionId:s},t?{subjectId:t}:{}),n?{mode:n}:{}),{startedAt:m(),completedAt:null});return o(h(i,A)).pipe(a(()=>i.key))}completeQuestioningSession(e){let s=c(this.db,`questioning-sessions/${e}`);return o(S(s,{completedAt:m()}))}updateQuestioningSessionResults(e,s){let t=c(this.db,`questioning-sessions/${e}`);return o(S(t,b(u({},s),{updatedAt:m()})))}getQuestioningSession(e){let s=c(this.db,`questioning-sessions/${e}`);return o(p(s)).pipe(a(t=>t.exists()?t.val():null))}getSessionsForUser(e){let s=c(this.db,"questioning-sessions"),t=l(s,g("userId"),d(e));return o(p(t)).pipe(a(n=>{if(!n.exists())return[];let r=[];return n.forEach(i=>{r.push(i.val())}),r}))}saveAttempt(e){let s=c(this.db,"attempts"),t=v(s),n=b(u({id:t.key},e),{createdAt:m()});return o(h(t,n)).pipe(a(()=>t.key))}getAttemptsForSession(e){let s=c(this.db,"attempts"),t=l(s,g("questioningSessionId"),d(e));return o(p(t)).pipe(a(n=>{if(!n.exists())return[];let r=[];return n.forEach(i=>{r.push(i.val())}),r.sort((i,A)=>i.createdAt-A.createdAt)}))}getAttemptsForUser(e){let s=c(this.db,"attempts"),t=l(s,g("userId"),d(e));return o(p(t)).pipe(a(n=>{if(!n.exists())return[];let r=[];return n.forEach(i=>{r.push(i.val())}),r}))}getIncorrectAttemptsForSession(e){return this.getAttemptsForSession(e).pipe(a(s=>s.filter(t=>!t.isCorrect)))}getUserQuestionStats(e){return this.getAttemptsForUser(e).pipe(a(s=>{let t={};return s.forEach(n=>{let r=n.questionId;t[r]||(t[r]={total:0,correct:0,incorrect:0}),t[r].total++,n.isCorrect?t[r].correct++:t[r].incorrect++}),t}))}static \u0275fac=function(s){return new(s||f)(q(y))};static \u0275prov=I({token:f,factory:f.\u0275fac,providedIn:"root"})};export{R as a};
