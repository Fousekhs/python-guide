<div class="container">
  <header>
    <div class="header-title">
      <div style="display:flex; align-items:center; gap:.5rem;">
        <svg-python class="logo-icon" />
        <div class="welcome-text">
          @let isAuthenticated = (userIsAuthenticated$ | async);
          <div class="username">{{ userDisplayName$ | async }}</div>
          <div class="points-row">{{ (userPoints$ | async) || 0 }} pts</div>
        </div>
      </div>
      <div style="flex-grow:1"></div>
      @if (isAuthenticated) {
        <button class="login-button" (click)="logout()">
          <div class="login-label">Logout</div>
          <svg-log-out />
        </button>
      } @else {
        <button class="login-button" (click)="login()">
          <div class="login-label">Login/Register</div>
          <svg-login-icon />
        </button>
      }
    </div>
  </header>

  <div class="content">
    <div class="logo">
      <svg-python />
    </div>
    <h2 style="text-align: center;">Welcome, {{ userDisplayName$ | async }}!</h2>

    @let canPractice = (hasPassedSubject$ | async);
    @if (canPractice !== null) {
      <div class="practice-buttons">
        <div class="buttons-row">
          <button class="practice-btn" [disabled]="!canPractice" (click)="startRandomPractice()">
            Random Questions
            <span class="pb-tooltip">{{ canPractice ? 'Get some practice questions from passed subjects.' : 'Pass at least one subject to enable.' }}</span>
          </button>
          <button class="practice-btn" [disabled]="!canPractice" (click)="startWorstPractice()">
            Worst Questions
            <span class="pb-tooltip">{{ canPractice ? 'Retry your worst-performing questions.' : 'Pass at least one subject to enable.' }}</span>
          </button>
          <button class="practice-btn" (click)="goToStats()">
            Stats
            <span class="pb-tooltip">View detailed performance analytics.</span>
          </button>
        </div>
      </div>
    }

    <app-section-container>
      @let sections = (sections$ | async);
      @if (sections?.length) {
        @for (section of sections; track section) {
          <app-section [title]="section.sectionPotentialMaxPoints ? section.title + ' (' + (section.sectionEarnedPoints || 0) + ' / ' + section.sectionPotentialMaxPoints + ' pts)' : section.title">
            <div class="section-content">
              @let subjects = section.subjects;
              @if (!subjects?.length) {
                <p>No subjects available.</p>
              } @else {
                @for (subject of subjects; track subject.id) {
                  <app-subject-card
                    [title]="subject.title"
                    [available]="subject.available"
                    [earnedPoints]="subject.earnedPoints"
                    [requiredPoints]="subject.requiredPoints"
                    [userTotalPoints]="subject.userTotalPoints"
                    [potentialMaxPoints]="subject.potentialMaxPoints"
                    [destination]="['/lesson', section.id, subject.id]"
                  ></app-subject-card>
                }
              }
            </div>
          </app-section>
        }
      } @else {
        <p>Loading content...</p>
      }
    </app-section-container>
  </div>
</div>